(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b9a7194"],{"504c":function(e,t,i){var s=i("0d58"),a=i("6821"),n=i("52a7").f;e.exports=function(e){return function(t){var i,o=a(t),c=s(o),r=c.length,l=0,u=[];while(r>l)n.call(o,i=c[l++])&&u.push(e?[i,o[i]]:o[i]);return u}}},"5b46":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Row",{attrs:{gutter:16}},[i("Col",{attrs:{span:"6"}},[i("Card",[i("div",{staticClass:"title"},[i("span",[e._v("职位")]),i("span",[e._v("当前选择:"+e._s(e.curPositionStr||"无"))])]),i("el-tree",{ref:"positions",attrs:{data:e.positions,"node-key":"id","expand-on-click-node":!1,props:{label:"alias",children:"positions"}},on:{"node-click":e.positionSelected}})],1)],1),i("Col",{attrs:{span:"6"}},[i("Card",[i("div",[e._v("会员等级")]),i("RadioGroup",{staticClass:"radio-button-ver",attrs:{type:"button",vertical:""},on:{"on-change":e.memberSelect},model:{value:e.memberKey,callback:function(t){e.memberKey=t},expression:"memberKey"}},[i("Radio",{attrs:{label:"all"}},[e._v("全部不区分")]),i("Radio",{attrs:{label:"normal"}},[e._v("散客")]),e._l(e.memberRule,(function(t,s){return i("Radio",{key:s,attrs:{label:t.id}},[e._v(e._s(t.alias))])}))],2)],1)],1),[i("Col",{attrs:{span:"12"}},[i("Card",[i("div",[e._v("规则设置")]),i("Form",{ref:"calculationRule",attrs:{model:e.calculationRule,"label-width":80}},[i("FormItem",{staticClass:"mt",attrs:{label:"计算类型"}},[i("RadioGroup",{model:{value:e.calculationRule.type,callback:function(t){e.$set(e.calculationRule,"type",t)},expression:"calculationRule.type"}},[i("Radio",{attrs:{label:1}},[e._v("实付")]),i("Radio",{attrs:{label:2}},[e._v("原价")])],1)],1),i("Card",{staticClass:"mt"},[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("提成")]),i("p",{staticClass:"mt"},[e._v("指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.commission.specified.value,callback:function(t){e.$set(e.calculationRule.commission.specified,"value",t)},expression:"calculationRule.commission.specified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.commission.specified.type,callback:function(t){e.$set(e.calculationRule.commission.specified,"type",t)},expression:"calculationRule.commission.specified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1),i("p",{staticClass:"mt"},[e._v("非指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.commission.unspecified.value,callback:function(t){e.$set(e.calculationRule.commission.unspecified,"value",t)},expression:"calculationRule.commission.unspecified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.commission.unspecified.type,callback:function(t){e.$set(e.calculationRule.commission.unspecified,"type",t)},expression:"calculationRule.commission.unspecified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1)],1),i("Card",{staticClass:"mt"},[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("业绩")]),i("p",{staticClass:"mt"},[e._v("指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.perform.specified.value,callback:function(t){e.$set(e.calculationRule.perform.specified,"value",t)},expression:"calculationRule.perform.specified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.perform.specified.type,callback:function(t){e.$set(e.calculationRule.perform.specified,"type",t)},expression:"calculationRule.perform.specified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1),i("p",{staticClass:"mt"},[e._v("非指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.perform.unspecified.value,callback:function(t){e.$set(e.calculationRule.perform.unspecified,"value",t)},expression:"calculationRule.perform.unspecified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.perform.unspecified.type,callback:function(t){e.$set(e.calculationRule.perform.unspecified,"type",t)},expression:"calculationRule.perform.unspecified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1)],1),i("Card",{staticClass:"mt"},[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("赠金业绩")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.grants.value,callback:function(t){e.$set(e.calculationRule.grants,"value",t)},expression:"calculationRule.grants.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.grants.type,callback:function(t){e.$set(e.calculationRule.grants,"type",t)},expression:"calculationRule.grants.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1)],1),i("Card",{staticClass:"mt"},[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("扣成本")]),i("p",{staticClass:"mt"},[e._v("指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.cost.specified.value,callback:function(t){e.$set(e.calculationRule.cost.specified,"value",t)},expression:"calculationRule.cost.specified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.cost.specified.type,callback:function(t){e.$set(e.calculationRule.cost.specified,"type",t)},expression:"calculationRule.cost.specified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1),i("p",{staticClass:"mt"},[e._v("非指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.cost.unspecified.value,callback:function(t){e.$set(e.calculationRule.cost.unspecified,"value",t)},expression:"calculationRule.cost.unspecified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.cost.unspecified.type,callback:function(t){e.$set(e.calculationRule.cost.unspecified,"type",t)},expression:"calculationRule.cost.unspecified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1)],1),i("Card",{staticClass:"mt"},[i("p",{attrs:{slot:"title"},slot:"title"},[e._v("二次扣成本")]),i("p",{staticClass:"mt"},[e._v("指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.twice.specified.value,callback:function(t){e.$set(e.calculationRule.twice.specified,"value",t)},expression:"calculationRule.twice.specified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.twice.specified.type,callback:function(t){e.$set(e.calculationRule.twice.specified,"type",t)},expression:"calculationRule.twice.specified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1),i("p",{staticClass:"mt"},[e._v("非指定")]),i("Input",{attrs:{type:"number"},model:{value:e.calculationRule.twice.unspecified.value,callback:function(t){e.$set(e.calculationRule.twice.unspecified,"value",t)},expression:"calculationRule.twice.unspecified.value"}},[i("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.calculationRule.twice.unspecified.type,callback:function(t){e.$set(e.calculationRule.twice.unspecified,"type",t)},expression:"calculationRule.twice.unspecified.type"}},[i("Radio",{attrs:{label:1}},[e._v("比例")]),i("Radio",{attrs:{label:2}},[e._v("固定")])],1)],1)],1),i("div",{staticClass:"mt"},[i("FormItem",{staticClass:"btn-wrapper"},[i("Button",{attrs:{type:"primary"},on:{click:function(t){e.saveRule("calculationRule")}}},[e._v("保存")]),i("Button",{attrs:{type:"error"},on:{click:function(t){e.handleDelete(e.curId)}}},[e._v("删除")])],1)],1)],1)],1)],1)]],2)},a=[],n=i("be94"),o=(i("7514"),i("456d"),i("ac6a"),i("8615"),i("cadf"),i("551c"),i("097d"),i("b39c")),c={data:function(){return{curId:0,curRule:{},allRules:{},curPositionStr:"",positions:[],memberKey:"all",memberRule:"",calculationRule:JSON.parse(JSON.stringify(o["e"])),form:{position_id:"",source:"tenant_speedy",rule:{}}}},watch:{"form.position_id":function(){this.memberKey&&this.isRuleExist()},memberKey:function(){this.form.position_id&&this.isRuleExist()}},mounted:function(){this.init()},methods:{init:function(){var e=this;this.$api.common.getPosition().then((function(t){e.positions=Object.values(t.data).filter((function(e){return 0===e.status})),e.positions.map((function(e){e.positions=Object.keys(e.positions).length?Object.values(e.positions).filter((function(e){return 0===e.status})):[]}))})),this.memberRule=Object.values(JSON.parse(this.$store.getters.userInfo.member_rule)),this.$api.user.getRules().then((function(t){e.allRules=t.data.tenant_speedy||{}}))},positionSelected:function(e){this.setPositionId(e.id);var t=this.positions.find((function(t){return t.positions.find((function(t){return e.id===t.id}))})),i=t?t.id:-1;if(this.allRules[e.id]){var s=this.allRules[e.id];if(this.curId=s.id,s.rule)this.form.rule=JSON.parse(s.rule)||{};else if(this.allRules[i]){var a=this.allRules[i];this.form.rule=JSON.parse(a.rule)||{}}}else if(this.allRules[i]){var n=this.allRules[i];this.form.rule=JSON.parse(n.rule)||{}}else this.form.rule={}},memberSelect:function(e){this.memberKey=e},setPositionId:function(e){var t=this;this.form.position_id=e,this.positions.some((function(i){if(e===i.id)return t.curPositionStr=i.alias,!0;var s=i.alias;null!==i.positions&&Object.values(i.positions).some((function(i){if(e===i.id)return s+=">".concat(i.alias),t.curPositionStr=s,!0}))}))},isRuleExist:function(){this.form.rule&&this.form.rule[this.memberKey]?this.calculationRule=this.form.rule[this.memberKey]:this.form.rule&&this.form.rule["all"]?this.calculationRule=JSON.parse(JSON.stringify(this.form.rule["all"])):this.calculationRule=JSON.parse(JSON.stringify(o["e"]))},saveRule:function(e){this.form.position_id?this.memberKey?(this.form.rule[this.memberKey]=this.calculationRule,this.allRules[this.form.position_id]?this.handleEdit(e):this.handleSubmit(e)):this.$Message.error("请先选择要修改的会员等级"):this.$Message.error("请先选择要修改的职位")},handleSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var i=JSON.parse(JSON.stringify(t.form));i.rule=JSON.stringify(i.rule),t.$api.user.add_royalty(i).then((function(e){t.afterOperation(),t.$Message.success("保存成功")}))}else t.$Message.error(res.message)}))},handleEdit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var i=Object(n["a"])({},t.form);i.rule=JSON.stringify(i.rule),t.$api.user.edit_royalty(t.curId,i).then((function(e){t.afterOperation(),t.$Message.success("保存成功")}))}else t.$Message.error(res.message)}))},handleDelete:function(e){var t=this;this.$Modal.confirm({title:"信息",content:"是否确认删除?",onOk:function(){var i=this;this.$api.user.del_royalty(e).then((function(e){t.clear(),i.$Message.success("删除成功")}))}})},afterOperation:function(){var e=this;this.$api.user.getRules().then((function(t){e.allRules=t.data.tenant_speedy||{},e.positionSelected({id:e.form.position_id}),setTimeout((function(){e.isRuleExist()}),0)}))},clear:function(){var e=this;this.init(),this.$nextTick((function(){e.memberKey="all",e.form.position_id="",e.form.rule={},e.curPositionStr=""}))}}},r=c,l=(i("74dd"),i("2877")),u=Object(l["a"])(r,s,a,!1,null,"0f56d37d",null);u.options.__file="speedy.vue";t["default"]=u.exports},7025:function(e,t,i){},"74dd":function(e,t,i){"use strict";var s=i("7025"),a=i.n(s);a.a},8615:function(e,t,i){var s=i("5ca1"),a=i("504c")(!1);s(s.S,"Object",{values:function(e){return a(e)}})},b39c:function(e,t,i){"use strict";i.d(t,"j",(function(){return a})),i.d(t,"g",(function(){return n})),i.d(t,"i",(function(){return o})),i.d(t,"h",(function(){return c})),i.d(t,"k",(function(){return l})),i.d(t,"e",(function(){return u})),i.d(t,"d",(function(){return p})),i.d(t,"c",(function(){return d})),i.d(t,"n",(function(){return m})),i.d(t,"m",(function(){return f})),i.d(t,"b",(function(){return v})),i.d(t,"f",(function(){return y})),i.d(t,"a",(function(){return b})),i.d(t,"l",(function(){return R}));i("7f7f"),i("7514"),i("6762"),i("2fdb"),i("c5f6"),i("456d"),i("ac6a"),i("5df3"),i("f400"),i("cadf"),i("551c"),i("097d");var s=i("4360");function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={member_id:"",payment_arrears:"",payment_balance:"",payment_giving:"",payment_integral:"",order_no:"",ignore_order_no:0,shopping_cart:"",consume_type:"",system_calculate:"",gross_price:"",profit_price:"",integral:"",prestore_price:"",giving_price:"",arrears_price:"",alias:"",phone:"",gender:"",payments:"",coupones:"",commodity_surplus:"",meter_oredes:"",meter_combo_oredes:"",order_time:"",memo:"",is_new_member:0,notify:1,notify_format:"",bonus:"",body_count:""};return _(t,e),t}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return[{type:e,staff_id:"",performance_price:"",dividends_price:"",specified_switch:0,source_id:0,source_alias:t,source_weight:0,index:1,show_num:"",cur_position:{},rule:""}]}function o(){return[c()]}function c(){return{type:"",category:{},good:{},originalPrice:"",qty:"",discount:"",discountPrice:"",presentPrice:"",discountPresentPrice:"",bonusList:n()}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=[{payment_name:"现金",amount_price:""},{payment_name:"微信",amount_price:""},{payment_name:"支付宝",amount_price:""},{payment_name:"银联",amount_price:""},{payment_name:"pos",amount_price:""},{payment_name:"免单",amount_price:""},{payment_name:"收钱吧",amount_price:""},{payment_name:"美团",amount_price:""},{payment_name:"其他",amount_price:""}];if("member"===e){var i=JSON.parse(JSON.stringify(t));return i.splice(0,0,{payment_name:"余额",amount_price:""},{payment_name:"赠金",amount_price:""},{payment_name:"欠款",amount_price:""},{payment_name:"积分",amount_price:""}),i}return t}var u={type:1,commission:{specified:{type:1,value:0},unspecified:{type:1,value:0}},perform:{specified:{type:1,value:0},unspecified:{type:1,value:0}},grants:{type:1,value:0},cost:{specified:{type:1,value:0},unspecified:{type:1,value:0}},twice:{specified:{type:1,value:0},unspecified:{type:1,value:0}}},p={commission:{specified:{type:1,value:0},unspecified:{type:1,value:0}},perform:{specified:{type:1,value:0},unspecified:{type:1,value:0}},grants:{type:1,value:0}},d={1:{type:1,employees:[JSON.parse(JSON.stringify(p))]},2:{type:1,employees:[JSON.parse(JSON.stringify(p)),JSON.parse(JSON.stringify(p))]},3:{type:1,employees:[JSON.parse(JSON.stringify(p)),JSON.parse(JSON.stringify(p)),JSON.parse(JSON.stringify(p))]}},m={type:1,commission:{specified:{type:1,value:0},unspecified:{type:1,value:0}},perform:{specified:{type:1,value:0},unspecified:{type:1,value:0}},grants:{type:1,value:0},cost:{specified:{type:1,value:0},unspecified:{type:1,value:0}},twice:{specified:{type:1,value:0},unspecified:{type:1,value:0}}},f={};function v(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=100,o=new Map([["commission",l],["perform",p],["grants",d],["pgSum",u],["cost",m],["twice",f]]);Object.keys(e).map((function(t){e[t].value&&(e[t].value=Number(e[t].value)),["type","grants"].includes(t)||(e[t]=s?e[t].specified:e[t].unspecified)}));var c={cost:0,twice:0,perform:0,grants:0,pgSum:0,commission:0};return a.custom&&_(c,a.custom),a.assign?(o.get(a.assign)(e[a.assign],c),c):(Object.keys(c).forEach((function(t){if(!c[t]&&(!a.custom||!a.custom.hasOwnProperty(t))&&("pgSum"===t&&o.get(t)(c),e.hasOwnProperty(t))){if(1!==e[t].type&&2!==e[t].type)throw new Error("错误类型值r.type：".concat(r.type));e[t].value&&o.get(t)(e[t],c)}})),Object.keys(c).map((function(e){c[e]=Number(c[e]).toFixed(2)})),c);function l(e,i){var s=i.pgSum||t-i.cost-i.twice||0;1===e.type?i.commission=s*e.value/n:2===e.type&&(i.commission=Number(e.value))}function u(e){e.pgSum=e.perform+e.grants}function p(e,i){var s=t-i.cost-i.twice;1===e.type?i.perform=s*e.value/n:2===e.type&&(i.perform=Number(e.value))}function d(e,t){1===e.type?t.grants=i*e.value/n:2===e.type&&(t.grants=Number(e.value))}function m(e,i){1===e.type?i.cost=t*e.value/n:2===e.type&&(i.cost=Number(e.value))}function f(e,i){1===e.type?i.twice=(t-i.cost)*e.value/n:2===e.type&&(i.twice=Number(e.value))}}var y=10;function b(e){var t={type:"commodity",num:0,price:0,memberPrice:0,cost:0,onlyDiscountByGood:0,isSpecial:0,recoup:0,discount:1,memberDiscount:1,good:{},memberRule:{}};_(t,e);var i=Boolean(Object.keys(t.memberRule).length),s=t.good;if(t.price=s.sale_price,t.memberPrice=s.member_price,t.cost=s.cost_price,t.onlyDiscountByGood=s.discount_switch,t.isSpecial=s.special_switch,t.recoup=s.again_member_switch,t.discount=s.discount,t.discount/=y,i)switch(t.type){case"commodity":t.memberDiscount=Number(t.memberRule.commodity)/y;break;case"services":t.memberDiscount=Number(t.memberRule.project)/y;break;case"count":t.memberDiscount=Number(t.memberRule.project)/y;break;default:break}var a={type:-1,originalPrice:0,discount:10,discountPrice:0,originalPriceAll:0,discountPriceAll:0};if(!t.type)return a;var n=!1,o={};if(i&&"services"===t.type&&t.good.member_rule){var c=JSON.parse(t.good.member_rule);n=c[t.memberRule.id],o=c[t.memberRule.id]}return a.originalPrice=i&&"count"!==t.type?t.memberPrice:t.price,"count"===t.type?!t.good.special_switch&&i?(a.discount=t.memberDiscount,a.discountPrice=a.originalPrice*a.discount):(a.discount=1,a.discountPrice=a.originalPrice):n?1===Number(o.type)?(a.discount=1,a.discountPrice=Number(o.ratio)):(a.discount=Number(o.ratio)/y,a.discountPrice=a.originalPrice*a.discount):t.onlyDiscountByGood?(a.type=2,a.discount=t.discount,a.discountPrice=a.originalPrice*a.discount):t.recoup?(a.type=3,a.discount=t.discount*(t.memberDiscount||1),a.discountPrice=a.originalPrice*a.discount):(a.type=1,a.discount=t.discount,a.discountPrice=a.originalPrice),a.originalPriceAll=a.originalPrice*t.num,a.discountPriceAll=a.discountPrice*t.num,Object.keys(a).forEach((function(e){a[e]="discount"!==e?Number(a[e]).toFixed(2):Number(10*a[e]).toFixed(1)})),a}function _(e,t){Object.keys(t).map((function(i){e.hasOwnProperty(i)&&(e[i]=t[i])}))}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>2?arguments[2]:void 0,i=s["a"].getters.userInfo,a="";if(["good","count"].includes(e)){var n=[];t.goodList&&t.goodList.map((function(e){if(Object.keys(e.good).length&&e.good.id){var t=n.find((function(t){return t.id===e.good.id}));t?(t.qty+=Number(e.qty),t.price+=Number(e.discountPriceAll)):n.push({id:e.good.id,name:e.good.alias,qty:Number(e.qty),price:Number(e.discountPriceAll)})}})),n.map((function(e,t){a+="".concat(e.name,"(数量：").concat(e.qty,"，价格：").concat(e.price,")").concat(t===n.length-1?"":",")}))}var o={lable:"card"===e||"recharge"===e?"充值":"消费",sms:{title:"".concat(i.sms_title),remake:"".concat(i.sms_remake)},wechat:{first:a,remake:"".concat(i.sms_remake," ").concat(i.telephone)}};return"count"===e&&(o.sms.meter=a),"card"===e?o.wechat.first="开卡 ".concat(t.gross_price,"元"):"recharge"===e?o.wechat.first="充值 ".concat(t.gross_price,"元"):"consume"===e&&(o.wechat.first="快速消费 ".concat(t.gross_price,"元")),o}},f400:function(e,t,i){"use strict";var s=i("c26b"),a=i("b39a"),n="Map";e.exports=i("e0b8")(n,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=s.getEntry(a(this,n),e);return t&&t.v},set:function(e,t){return s.def(a(this,n),0===e?0:e,t)}},s,!0)}}]);