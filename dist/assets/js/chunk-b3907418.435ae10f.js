(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b3907418"],{"0452":function(e,t,l){"use strict";var o=l("a01c"),r=l.n(o);r.a},"504c":function(e,t,l){var o=l("0d58"),r=l("6821"),a=l("52a7").f;e.exports=function(e){return function(t){var l,s=r(t),n=o(s),i=n.length,c=0,u=[];while(i>c)a.call(s,l=n[c++])&&u.push(e?[l,s[l]]:s[l]);return u}}},7114:function(e,t,l){"use strict";l.r(t);var o=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"app-container"},[l("div",{staticClass:"func"},[l("span",[l("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.showform}},[e._v("添加服务项目")]),l("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){e.$router.push("classification/services")}}},[e._v("分类管理")])],1)]),l("el-table",{staticClass:"table-consume-custom",attrs:{data:e.list,"header-cell-class-name":"el-table-header-cell-custom",fit:""}},[l("el-table-column",{attrs:{align:"center",label:"编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.serial_num))]}}])}),l("el-table-column",{attrs:{align:"center",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alias))]}}])}),l("el-table-column",{attrs:{align:"center",label:"分类"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.category[t.row.category_id].alias||""))]}}])}),l("el-table-column",{attrs:{align:"center",label:"条形码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.bar_code))]}}])}),l("el-table-column",{attrs:{align:"center",label:"售价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.sale_price))]}}])}),l("el-table-column",{attrs:{align:"center",label:"会员价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member_price))]}}])}),l("el-table-column",{attrs:{align:"center",label:"成本价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.cost_price))]}}])}),l("el-table-column",{attrs:{align:"center",label:"库存数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.surplus_num))]}}])}),l("el-table-column",{attrs:{align:"center",label:"折扣"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.discount))]}}])}),l("el-table-column",{attrs:{align:"center",label:"只取服务折扣"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.discount_switch?"是":"否"))]}}])}),l("el-table-column",{attrs:{align:"center",label:"特价"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.special_switch?"是":"否"))]}}])}),l("el-table-column",{attrs:{align:"center",label:"是否会员价在折扣"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.again_member_switch?"是":"否"))]}}])}),l("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[l("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(l){e.handleChange(t.row)}}},[e._v("修改")]),l("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(l){e.handleDelete(t.row)}}},[e._v("删除")]),l("el-button",{attrs:{type:"success",size:"small"},on:{click:function(l){e.handleMemberRuleChange(t.row)}}},[e._v("会员折扣")])],1)]}}])})],1),l("Modal",{attrs:{title:"服务项目管理","mask-closable":!1,closable:!1},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[l("Form",{attrs:{"label-width":130}},[l("FormItem",{attrs:{label:"编号:"}},[l("Input",{attrs:{type:"number",placeholder:"编号"},model:{value:e.form.serial_num,callback:function(t){e.$set(e.form,"serial_num",t)},expression:"form.serial_num"}})],1),l("FormItem",{attrs:{label:"名称:"}},[l("Input",{attrs:{placeholder:"名称"},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),l("FormItem",{attrs:{label:"分类:"}},[l("Select",{attrs:{filterable:"","allow-create":""},on:{"on-create":e.createCategory},model:{value:e.form.category_str,callback:function(t){e.$set(e.form,"category_str",t)},expression:"form.category_str"}},[e._l(this.category,(function(t,o){return[l("Option",{key:t.id,attrs:{value:t.alias,label:t.alias}},[e._v(e._s(t.alias))])]}))],2)],1),l("FormItem",{attrs:{label:"售价:"}},[l("Input",{attrs:{type:"number",placeholder:"售价"},model:{value:e.form.sale_price,callback:function(t){e.$set(e.form,"sale_price",t)},expression:"form.sale_price"}})],1),l("FormItem",{attrs:{label:"会员价:"}},[l("Input",{attrs:{type:"number",placeholder:"会员价"},model:{value:e.form.member_price,callback:function(t){e.$set(e.form,"member_price",t)},expression:"form.member_price"}})],1),l("FormItem",{attrs:{label:"成本价:"}},[l("Input",{attrs:{type:"number",placeholder:"成本价"},model:{value:e.form.cost_price,callback:function(t){e.$set(e.form,"cost_price",t)},expression:"form.cost_price"}})],1),l("FormItem",{attrs:{label:"条形码:"}},[l("Input",{attrs:{placeholder:"条形码"},model:{value:e.form.bar_code,callback:function(t){e.$set(e.form,"bar_code",t)},expression:"form.bar_code"}})],1),l("FormItem",{attrs:{label:"库存数:"}},[l("Input",{attrs:{type:"number",placeholder:"库存数"},model:{value:e.form.surplus_num,callback:function(t){e.$set(e.form,"surplus_num",t)},expression:"form.surplus_num"}})],1),l("FormItem",{attrs:{label:"折扣:"}},[l("Input",{attrs:{placeholder:"折扣"},model:{value:e.form.discount,callback:function(t){e.$set(e.form,"discount",t)},expression:"form.discount"}})],1),l("FormItem",{attrs:{label:"回访日期(天):"}},[l("Input",{attrs:{placeholder:"回访日期(天)"},model:{value:e.form.follow_time,callback:function(t){e.$set(e.form,"follow_time",t)},expression:"form.follow_time"}})],1),l("FormItem",{attrs:{label:"只取服务折扣:"}},[l("RadioGroup",{model:{value:e.form.discount_switch,callback:function(t){e.$set(e.form,"discount_switch",t)},expression:"form.discount_switch"}},[l("Radio",{attrs:{label:1}},[e._v("是")]),l("Radio",{attrs:{label:0}},[e._v("否")])],1)],1),l("FormItem",{attrs:{label:"特价:"}},[l("RadioGroup",{model:{value:e.form.special_switch,callback:function(t){e.$set(e.form,"special_switch",t)},expression:"form.special_switch"}},[l("Radio",{attrs:{label:1}},[e._v("是")]),l("Radio",{attrs:{label:0}},[e._v("否")])],1)],1),l("FormItem",{attrs:{label:"是否会员价再折扣:"}},[l("RadioGroup",{model:{value:e.form.again_member_switch,callback:function(t){e.$set(e.form,"again_member_switch",t)},expression:"form.again_member_switch"}},[l("Radio",{attrs:{label:1}},[e._v("是")]),l("Radio",{attrs:{label:0}},[e._v("否")])],1)],1)],1),l("div",{staticStyle:{"font-size":"12px"}},[e._v("说明：特价选择是，其它折扣全为否则特价生效")]),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"warning",size:"large",small:""},on:{click:e.cancel}},[e._v("取消")]),l("Button",{attrs:{type:"success",size:"large",small:""},on:{click:e.ok}},[e._v("确认")])],1)],1),l("Modal",{attrs:{title:e.selectProjectName,"mask-closable":!1,closable:!1},model:{value:e.memberRuleShow,callback:function(t){e.memberRuleShow=t},expression:"memberRuleShow"}},[l("div",{staticClass:"member-level"},[Object.keys(e.oldRuleForm).length?l("div",{staticClass:"list"},e._l(e.memberRule,(function(t,o){return l("div",{key:o,staticClass:"item"},[l("div",{staticClass:"title"},[e._v(e._s(t.alias)+"：")]),l("div",{staticClass:"input"},[l("el-input",{attrs:{type:"number",placeholder:0===e.oldRuleForm[t.id].type?"请填写折扣":"请填写金额"},model:{value:e.oldRuleForm[t.id].ratio,callback:function(l){e.$set(e.oldRuleForm[t.id],"ratio",l)},expression:"oldRuleForm[item.id].ratio"}},[l("el-radio-group",{attrs:{slot:"prepend",size:"medium"},slot:"prepend",model:{value:e.oldRuleForm[t.id].type,callback:function(l){e.$set(e.oldRuleForm[t.id],"type",l)},expression:"oldRuleForm[item.id].type"}},[l("el-radio",{attrs:{label:0}},[e._v("折扣")]),l("el-radio",{attrs:{label:1}},[e._v("金额")])],1)],1)],1)])}))):l("div",[e._v("请先设置会员等级")])]),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("Button",{attrs:{type:"warning",size:"large",small:""},on:{click:function(t){e.memberRuleShow=!1}}},[e._v("取消")]),l("Button",{attrs:{type:"success",size:"large",small:""},on:{click:e.ruleOk}},[e._v("确认")])],1)])],1)},r=[],a=(l("6b54"),l("8615"),l("ac6a"),l("c24f")),s={name:"project",data:function(){return{show:!1,memberRuleShow:!1,list:[],selectProject:{},selectProjectName:"",memberRule:null,oldForm:{},form:{again_member_switch:1,alias:null,bar_code:null,category_str:null,category_id:null,cost_price:null,discount:null,discount_switch:0,id:null,master_id:null,member_price:null,sale_price:null,serial_num:null,special_switch:0,status:null,surplus_num:null,tenant_id:null,follow_time:0},oldRuleForm:{},project:{},category:{}}},mounted:function(){this.getList()},methods:{getList:function(){var e=this;this.$api.common.getCategory().then((function(t){e.category=t.data["tenant_project"]||{}})).then((function(){e.$api.common.getProject().then((function(t){e.project=t.data,e.list=[],Object.values(e.project).forEach((function(t){t&&(e.list=e.list.concat(t.filter((function(e){return 0===e.status}))))})),e.memberRule=Object.values(JSON.parse(e.$store.getters.userInfo.member_rule))}))}))},handleMemberRuleChange:function(e){var t=this;this.selectProject=JSON.parse(JSON.stringify(e)),this.selectProjectName=this.project[e.category_id].filter((function(t){return t.id===e.id}))[0].alias,null!==e.member_rule&&(this.oldRuleForm=JSON.parse(e.member_rule)),this.memberRule.map((function(e){t.oldRuleForm[e.id]||t.$set(t.oldRuleForm,e.id,{type:0,ratio:""})})),this.memberRuleShow=!0},ruleOk:function(){var e=this,t=JSON.parse(JSON.stringify(this.oldRuleForm));this.selectProject.member_rule=JSON.stringify(t),Object(a["edit_project"])(this.selectProject,this.selectProject.id).then((function(t){e.$Message.info("操作成功"),e.getList(),e.memberRuleShow=!1}))},handleDelete:function(e){var t=this;this.$Modal.confirm({title:"信息",content:"是否确认删除？",onOk:function(){Object(a["del_project"])(e.id).then((function(e){t.$Message.info("操作成功"),t.getList()}))}})},handleChange:function(e){for(var t in e=JSON.parse(JSON.stringify(e)),this.oldForm=e,this.form)this.form[t]=e.hasOwnProperty(t)?e[t]:null;this.form.category_str=this.category[this.form.category_id].alias,this.show=!0},createCategory:function(e){this.form.category_str=e.toString(),this.form.category_id=0;var t=Math.round(new Date/1e3);this.category[t]={id:t,alias:e}},showform:function(){this.clear(),this.show=!0},ok:function(){var e=this;this.form.discount||(this.form.discount=10);var t=JSON.parse(JSON.stringify(this.form));null===this.form.id?Object(a["add_project"])(t).then((function(t){e.$Message.info("操作成功"),e.getList(),e.show=!1})):(t.old=this.oldForm,Object(a["edit_project"])(t,t.id).then((function(t){e.oldForm={},e.$Message.info("操作成功"),e.getList(),e.show=!1}))),this.clear()},cancel:function(){this.clear(),this.oldForm={},this.show=!1},clear:function(){this.form={again_member_switch:1,alias:null,bar_code:null,category_str:null,category_id:null,cost_price:null,discount:null,discount_switch:0,id:null,master_id:null,member_price:null,sale_price:null,serial_num:null,special_switch:0,status:null,surplus_num:null,tenant_id:null,follow_time:0}}}},n=s,i=(l("0452"),l("2877")),c=Object(i["a"])(n,o,r,!1,null,"17e795bd",null);c.options.__file="project.vue";t["default"]=c.exports},8615:function(e,t,l){var o=l("5ca1"),r=l("504c")(!1);o(o.S,"Object",{values:function(e){return r(e)}})},a01c:function(e,t,l){}}]);