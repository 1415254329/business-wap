(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5589f83f"],{"08dc":function(e,t,r){},"10c2":function(e,t,r){},1962:function(e,t,r){"use strict";function n(e,t){var r=[{}];return r=t.filter(n(e)),r;function n(e){return function(t){return t.phone.indexOf(e)>=0||t.serial_num.indexOf(e)>=0||t.alias.toLowerCase().indexOf(e.toLowerCase())>=0||t.alias_spell.indexOf(e)>=0}}}r.d(t,"a",(function(){return n}))},"1e00":function(e,t,r){},"24d9":function(e,t,r){"use strict";var n=r("3592"),i=r.n(n);i.a},"2a35":function(e,t,r){},"30f4":function(e,t,r){"use strict";var n=r("be6c"),i=r.n(n);i.a},"321d":function(e,t,r){"use strict";var n=r("10c2"),i=r.n(n);i.a},3592:function(e,t,r){},"3cbd":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"func"},[r("div",{staticClass:"search"},[r("el-date-picker",{attrs:{type:"daterange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right",size:"small","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dateDuring,callback:function(t){e.dateDuring=t},expression:"dateDuring"}}),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.getList("normal")}}},[e._v("搜索")])],1)]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"table-consume-custom",attrs:{data:e.list.slice((e.pageVar.page-1)*e.pageVar.pageSize,e.pageVar.page*e.pageVar.pageSize),"span-method":e.rowMerge,"cell-class-name":e.bonusCellClass,"header-cell-class-name":"el-table-header-cell-custom",fit:""}},[r("el-table-column",{attrs:{align:"center",label:"下单时间",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.orderDate)),r("br"),e._v(e._s(t.row.orderTime))]}}])}),r("el-table-column",{attrs:{align:"center",label:"单号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.order_no))]}}])}),r("el-table-column",{attrs:{align:"center",label:"会员资料",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v(e._s((t.row.alias||"散客")+"("+(t.row.gender?"男":"女")+"客:"+t.row.body_count+")"))]),r("p",[e._v(e._s(t.row.phone))]),r("p",[e._v("("+e._s(t.row.member_serial_num||"无卡号信息")+")")])]}}])}),r("el-table-column",{attrs:{align:"center",label:"付款明细",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.payments,(function(t,n){return r("p",{key:n},[e._v("\n          "+e._s(t.payment_name+":"+t.amount_price)+"\n        ")])}))}}])}),r("el-table-column",{attrs:{align:"center",label:"合计",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.paymentSum))]}}])}),r("el-table-column",{attrs:{align:"center",label:"付款前余额",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member_balance_befor_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"付款后余额",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member_balance_after_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"付款前赠金",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member_giving_befor_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"付款后赠金",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member_giving_after_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"项目明细","class-name":"bonus-column-custom"}},[r("el-table-column",{attrs:{align:"center",label:"消费项目"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"bonus"},[t.row.shopping_cart.length?r("div",e._l(t.row.shopping_cart,(function(t,n){return r("div",{key:n,staticClass:"bonus-item"},[r("div",{staticClass:"name"},[e._v("\n                  "+e._s(t.good.alias)+"\n                  "),r("br"),e._v("\n                  (原价:"+e._s(t.good.sale_price)+")\n                  "),r("br"),["countBuyUse","countBoughtUse"].includes(t.type)?r("span",[r("br"),e._v(e._s("(使用"+t.useTimes+"次)")+"\n                  ")]):e._e()]),r("div",{staticClass:"perform"},[e._v("\n                  "+e._s(""+(["countBuyUse","countBoughtUse"].includes(t.type)?t.good.employ_cardinal_price*Number(t.useTimes):t.discountPriceAll))+"\n                ")]),r("div",{staticClass:"staffList"},e._l(t.bonusList,(function(t,n){return r("div",{key:n,staticClass:"staffList-item"},[r("div",{staticClass:"staffList-item-name"},[e._v(e._s(t.staff.staff_name))]),r("div",{staticClass:"staffList-item-isSpecial"},[e._v("\n                      "+e._s(t.specified_switch?"是":"否")+"\n                    ")]),r("div",{staticClass:"staffList-item-perform"},[e._v("\n                      "+e._s(t.performance_price)+"\n                    ")]),r("div",{staticClass:"staffList-item-commission"},[e._v("\n                      "+e._s(t.dividends_price)+"\n                    ")])])})))])}))):r("div",{staticClass:"bonus-item"},[r("div",{staticClass:"name"},[t.row.is_new_member?r("span",[e._v("\n                  开卡\n                ")]):(t.row.prestore_price||t.row.giving_price)&&t.row.integral>=0?r("span",[e._v("\n                  充值\n                ")]):!t.row.prestore_price&&!t.row.giving_price&&t.row.integral>0&&!t.row.gross_price?r("span",[e._v("\n                  积分充值"+e._s(t.row.integral)+"\n                ")]):t.row.integral<0&&!t.row.gross_price?r("span",[e._v("\n                  积分消费"+e._s(-t.row.integral)+"兑换"+e._s(t.row.prestore_price)+"元\n                ")]):r("span",[e._v("\n                  快速消费\n                ")]),(t.row.is_new_member||t.row.prestore_price||t.row.giving_price)&&t.row.giving_price>0?r("span",[r("br"),e._v("(赠金:"+e._s(t.row.giving_price)+")\n                ")]):e._e()]),r("div",{staticClass:"perform"},[e._v("\n                "+e._s(t.row.paymentSum)+"\n              ")]),r("div",{staticClass:"staffList"},e._l(t.row.bonus,(function(t,n){return r("div",{key:n,staticClass:"staffList-item"},[r("div",{staticClass:"staffList-item-name"},[e._v(e._s(t.staff.staff_name))]),r("div",{staticClass:"staffList-item-isSpecial"},[e._v("\n                    "+e._s(t.specified_switch?"是":"否")+"\n                  ")]),r("div",{staticClass:"staffList-item-perform"},[e._v("\n                    "+e._s(t.performance_price)+"\n                  ")]),r("div",{staticClass:"staffList-item-commission"},[e._v("\n                    "+e._s(t.dividends_price)+"\n                  ")])])})))])])]}}])}),r("el-table-column",{attrs:{align:"center",label:"消费业绩"}}),r("el-table-column",{attrs:{align:"center",label:"员工信息"}}),r("el-table-column",{attrs:{align:"center",label:"是否指定"}}),r("el-table-column",{attrs:{align:"center",label:"员工业绩"}}),r("el-table-column",{attrs:{align:"center",label:"员工提成"}})],1),r("el-table-column",{attrs:{align:"center",label:"备注",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.memo))]}}])})],1),r("el-pagination",{attrs:{"current-page":e.pageVar.page,"page-sizes":e.pageVar.pageSizes,"page-size":e.pageVar.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageVar.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},i=[],o=(r("7514"),r("8615"),r("ac6a"),r("5df3"),r("f400"),r("c5f6"),r("ed08")),s={props:{show:{type:Boolean,default:function(){return!1}},memberId:{type:Number,default:function(){return 0}}},data:function(){return{dateDuring:"",searchForm:{start_time:"",end_time:"",memberId:""},listLoading:!1,list:[],staffList:[],pickerOptions:{shortcuts:[{text:"昨天",onClick:function(e){var t=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 00:00:00"),r=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 23:59:59");t.setTime(t.getTime()-864e5),r.setTime(r.getTime()-864e5),e.$emit("pick",[t,r])}},{text:"最近一周",onClick:function(e){var t=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 00:00:00"),r=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 23:59:59");t.setTime(t.getTime()-6048e5),e.$emit("pick",[t,r])}},{text:"最近一个月",onClick:function(e){var t=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 00:00:00"),r=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 23:59:59");t.setTime(t.getTime()-2592e6),e.$emit("pick",[t,r])}}]},pageVar:{page:1,total:0,pageSize:50,pageSizes:[10,20,30,40,50]}}},watch:{dateDuring:function(){this.dateDuring&&this.dateDuring.length?(this.searchForm.start_time=Object(o["i"])(this.dateDuring[0],"{y}-{m}-{d}")+" 00:00:00",this.searchForm.end_time=Object(o["i"])(this.dateDuring[1],"{y}-{m}-{d}")+" 23:59:59"):(this.searchForm.start_time="",this.searchForm.end_time="")},memberId:function(){this.memberId&&(this.searchForm.member_id=this.memberId)},show:function(){this.show&&this.getList()}},created:function(){var e=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 00:00:00"),t=new Date(Object(o["i"])((new Date).getTime(),"{y}-{m}-{d}")+" 23:59:59");e.setTime(e.getTime()-158112e5),this.dateDuring=[Object(o["i"])(e),Object(o["i"])(t)],setTimeout(function(){this.getList()}.bind(this))},methods:{getList:function(){var e=this;this.listLoading=!0;var t=new Map([["services","tenant_project"],["commodity","tenant_commodity"],["count","tenant_meter"],["countBuyUse","tenant_meter_employ"],["countBoughtUse","tenant_meter_employ"]]);function r(){var e=this;return this.$api.common.getStaffList().then((function(t){e.staffList=Object.values(t.data)}))}function n(){var e=this;return this.$api.business.getOrderList(this.searchForm).then((function(r){if(!r.data.orders&&(r.data.orders=[]),e.list=r.data.orders.filter((function(r){return 1!==r.obsolete_status&&(r.paymentSum=r.payments?r.payments.reduce((function(e,t){return e+t.amount_price}),0):"",r.bonus||(r.bonus=[]),r.shopping_cart&&(r.shopping_cart=JSON.parse(r.shopping_cart),r.shopping_cart.map((function(e){!e.bonusList&&(e.bonusList=[]);var n=t.get(e.type);n&&r.bonus.map((function(t){t.type===n&&Number(e.index)===Number(t.source_weight)&&e.bonusList.push(t)}))}))),r.bonus.map((function(t){t.staff=e.staffList.find((function(e){return Number(e.id)===t.staff_id}))})),!0)})),r.data.orders.map((function(e){e.orderDate=Object(o["i"])(new Date(e.order_time),"{y}-{m}-{d}"),e.orderTime=Object(o["i"])(new Date(e.order_time),"{h}:{i}:{s}")})),e.listLoading=!1,e.pageVar.total=e.list.length,r.data.diff&&r.data.diff.length){var n=r.data.diff.reduce((function(e,t){return e?e+","+t:t}),"");e.$alert("不存在的单号:".concat(n),"提示",{confirmButtonText:"确定"})}}))}this.staffList.length?n.call(this):r.call(this).then((function(){n.call(e)}))},handleSizeChange:function(e){this.pageVar.pageSize=e,this.pageVar.page=1},handleCurrentChange:function(e){this.pageVar.page=e},rowMerge:function(e){e.row,e.column,e.rowIndex;var t=e.columnIndex;return 9===t?{colspan:6,rowspan:1}:t>9&&t<15?[0,0]:void 0},bonusCellClass:function(e){e.row,e.column,e.rowIndex;var t=e.columnIndex;if(4===t)return"bonus-column-custom"}}},a=s,c=(r("30f4"),r("2877")),u=Object(c["a"])(a,n,i,!1,null,"4ef7679c",null);u.options.__file="orderMember.vue";t["a"]=u.exports},4901:function(e,t,r){},"504c":function(e,t,r){var n=r("0d58"),i=r("6821"),o=r("52a7").f;e.exports=function(e){return function(t){var r,s=i(t),a=n(s),c=a.length,u=0,l=[];while(c>u)o.call(s,r=a[u++])&&l.push(e?[r,s[r]]:s[r]);return l}}},"5a5a":function(e,t,r){"use strict";var n=r("ec03"),i=r.n(n);i.a},"72f7":function(e,t,r){"use strict";var n=r("2a35"),i=r.n(n);i.a},8615:function(e,t,r){var n=r("5ca1"),i=r("504c")(!1);n(n.S,"Object",{values:function(e){return i(e)}})},"8b7e":function(e,t,r){},"92af":function(e,t,r){},"99ac":function(e,t,r){"use strict";var n=r("b369"),i=r.n(n);i.a},"9ae9":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"consume"},[r("Card",{staticClass:"info"},[r("div",{staticClass:"row"},[r("member-search",{staticClass:"search-member",attrs:{memberList:e.memberList},on:{selected:e.handleMemberSelect}},[r("template",{slot:"prepend"},[e._v("\n          会员搜索\n        ")]),r("el-button",{attrs:{slot:"suffix",size:"medium",type:"primary",icon:"el-icon-search"},slot:"suffix"})],2),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:2,expression:"2"}],attrs:{type:"primary",size:"medium"},on:{click:function(){Object.keys(e.curMember).length?e.$router.push({path:"/directive/add/"+e.curMember.id,query:{needBackMemberId:"true",fromPath:e.$route.path}}):e.$Message.error("请先选择会员")}}},[e._v("修改会员")]),r("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(){Object.keys(e.curMember).length?e.orderShow=!0:e.$Message.error("请先选择会员")}}},[e._v("交易记录")]),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:1,expression:"1"}],attrs:{type:"primary",size:"medium"},on:{click:function(t){e.$router.push({path:"/directive/add/0",query:{needBackMemberId:"true",fromPath:e.$route.path}})}}},[e._v("注册会员")]),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:3,expression:"3"}],attrs:{type:"primary",size:"medium"},on:{click:function(){Object.keys(e.curMember).length?e.rechargeShow=!0:e.$Message.error("请先选择会员")}}},[e._v("会员充值")]),["consume","integral"].includes(e.$route.params.type)?e._e():r("count-use-btn",{attrs:{list:e.memberCountList},on:{use:e.handleCountUse,view:e.handleCountView}}),r("el-button",{attrs:{type:"primary",size:"medium"},on:{click:function(t){e.$router.push("/business/order")}}},[e._v("订单管理")])],1),r("el-table",{staticClass:"table-member-custom",staticStyle:{"margin-bottom":"0"},attrs:{"header-cell-class-name":"el-table-header-cell-custom",data:[e.curMember],fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"姓名","show-overflow-tooltip":"",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alias))]}}])}),r("el-table-column",{attrs:{align:"center",label:"卡号","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.serial_num))]}}])}),r("el-table-column",{attrs:{align:"center",label:"手机号","show-overflow-tooltip":"","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.phone))]}}])}),r("el-table-column",{attrs:{align:"center",label:"等级","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.hierarchyName))]}}])}),r("el-table-column",{attrs:{align:"center",label:"余额","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",{staticStyle:{color:"red"}},[e._v("\n            "+e._s(t.row.balance_price)+"\n          ")])]}}])}),r("el-table-column",{attrs:{align:"center",label:"赠金","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.giving_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"备注","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.memo))]}}])}),r("el-table-column",{attrs:{align:"center",label:"欠款","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.arrears_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"积分","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.integral))]}}])}),r("el-table-column",{attrs:{align:"center",label:"累计充值","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.cumsum_balance_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"累计消费","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.cumsum_pay_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"来源","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.origin))]}}])}),r("el-table-column",{attrs:{align:"center",label:"距今到店(天)","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.arrivalInterval))]}}])}),r("el-table-column",{attrs:{align:"center",label:"微信绑定","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(1!==t.row.wechat_bind_status?"":"是"))]}}])})],1),"good"===e.$route.params.type?r("Tabs",{model:{value:e.componentName,callback:function(t){e.componentName=t},expression:"componentName"}},[r("TabPane",{attrs:{label:"服务/商品消费",name:"good"}}),r("TabPane",{attrs:{label:"计次购买",name:"count"}})],1):e._e(),"integral"===e.$route.params.type?r("Tabs",{model:{value:e.componentName,callback:function(t){e.componentName=t},expression:"componentName"}},[r("TabPane",{attrs:{label:"积分商城",name:"integral"}}),r("TabPane",{attrs:{label:"积分兑现",name:"integralExchange"}}),r("TabPane",{attrs:{label:"积分换礼列表",name:"integralRecord"}})],1):e._e(),r(e.componentName,{tag:"component",attrs:{curMember:e.curMember,curMemberRule:e.curMemberRule,ruleList:e.ruleList,positionList:e.positionList,staffList:e.staffList,staffSortList:e.staffSortList},on:{"order-success":e.orderSuccess}})],1),r("Modal",{attrs:{width:"1200px"},model:{value:e.rechargeShow,callback:function(t){e.rechargeShow=t},expression:"rechargeShow"}},[e.rechargeShow?r("Recharge",{attrs:{ruleList:e.rechargeRuleList,curMember:e.curMember,curMemberRule:e.curMemberRule,memberRuleList:e.memberRuleList,positionList:e.positionList,staffList:e.staffList,staffSortList:e.staffSortList,presentRule:e.presentRule},on:{success:e.rechargeSuccess}}):e._e(),r("span",{attrs:{slot:"footer"},slot:"footer"})],1),r("Modal",{attrs:{width:"90%"},model:{value:e.orderShow,callback:function(t){e.orderShow=t},expression:"orderShow"}},[r("OrderMember",{attrs:{show:e.orderShow,memberId:e.curMember.id}}),r("span",{attrs:{slot:"footer"},slot:"footer"})],1),r("Modal",{attrs:{width:"1200px",styles:{marginTop:"10%"}},model:{value:e.debtShow,callback:function(t){e.debtShow=t},expression:"debtShow"}},[e.debtShow?r("Debt",{attrs:{curMember:e.curMember},on:{success:e.debtSuccess}}):e._e(),r("span",{attrs:{slot:"footer"},slot:"footer"})],1),r("Modal",{attrs:{width:"1200px",styles:{marginTop:"10%"}},model:{value:e.countUseShow,callback:function(t){e.countUseShow=t},expression:"countUseShow"}},[r("CountUseView",{attrs:{data:e.countUseViewData}}),r("span",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},i=[],o=(r("6762"),r("2fdb"),r("8615"),r("c5f6"),r("7514"),r("be94")),s=(r("ac6a"),r("456d"),r("cadf"),r("551c"),r("097d"),r("2f62")),a=r("fe63"),c=r("badc"),u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-popover",{attrs:{placement:"bottom",trigger:"click"},model:{value:e.listShow,callback:function(t){e.listShow=t},expression:"listShow"}},[r("el-badge",{staticClass:"item",attrs:{slot:"reference",value:e.list.length,hidden:!e.list.length},slot:"reference"},[r("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(t){e.handleListShow()}}},[e._v("\n      计次使用\n    ")])],1),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list.slice((e.pageVar.page-1)*e.pageVar.pageSize,e.pageVar.page*e.pageVar.pageSize)}},[r("el-table-column",{attrs:{align:"center",label:"购买日期",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.order_time))]}}])}),r("el-table-column",{attrs:{align:"center",label:"名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alias))]}}])}),r("el-table-column",{attrs:{align:"center",label:"总次数","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==t.row.validity_num?"无限次数":t.row.validity_num))]}}])}),r("el-table-column",{attrs:{align:"center",label:"剩余次数","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==t.row.validity_num?"无限次数":t.row.validity_num-t.row.uses_num))]}}])}),r("el-table-column",{attrs:{align:"center",label:"单次业绩","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.employ_cardinal_price))]}}])}),r("el-table-column",{attrs:{align:"center",label:"操作","show-overflow-tooltip":"",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[r("el-link",{attrs:{type:"primary"},on:{click:function(r){e.handleUse(t.row)}}},[e._v("使用")]),r("el-link",{attrs:{type:"success"},on:{click:function(r){e.handleView(t.row)}}},[e._v("查看")])],1)]}}])})],1),r("el-pagination",{attrs:{"current-page":e.pageVar.page,"page-sizes":e.pageVar.pageSizes,"page-size":e.pageVar.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageVar.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},l=[],m={props:{list:{type:Array,default:function(){}}},data:function(){return{listShow:!1,pageVar:{page:1,total:0,pageSize:10,pageSizes:[10,20,30,40,50]}}},watch:{list:function(){this.pageVar.total=this.list.length}},methods:{handleListShow:function(){this.listShow?this.listShow=!1:this.listShow=!0},handleUse:function(e){this.$store.getters.countBoughtUseList.some((function(t){return t.id===e.id}))?this.$Message.info("使用列表中已存在该项目"):(this.listShow=!1,this.$store.commit("business/setCountBoughtUseList",this.$store.getters.countBoughtUseList.concat([e])),this.$emit("use"))},handleView:function(e){e.employs&&e.employs.length?(this.listShow=!1,this.$emit("view",e)):this.$Message.info("该计次没有使用记录")},handleSizeChange:function(e){this.pageVar.pageSize=e,this.pageVar.page=1},handleCurrentChange:function(e){this.pageVar.page=e}}},d=m,p=(r("5a5a"),r("2877")),f=Object(p["a"])(d,u,l,!1,null,"da85fb9a",null);f.options.__file="countUseBtn.vue";var h=f.exports,b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"consume"},[r("el-table",{staticClass:"table-consume-custom",attrs:{"header-cell-class-name":"el-table-header-cell-custom",data:[{}],fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"消费金额","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.originalPrice,callback:function(t){e.originalPrice=t},expression:"originalPrice"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"折扣","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.discount,callback:function(t){e.discount=t},expression:"discount"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"折后价","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.discountPrice,callback:function(t){e.discountPrice=t},expression:"discountPrice"}})]}}])}),Object.keys(e.curMember).length?r("el-table-column",{attrs:{align:"center",label:"赠金","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.presentPrice,callback:function(t){e.presentPrice=t},expression:"presentPrice"}})]}}])}):e._e(),e._l(e.staffSortList,(function(t,n){return r("el-table-column",{key:n,attrs:{align:"center",label:t.alias}},[r("el-table-column",{attrs:{align:"center",label:"工号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(i){return[r("Poptip",{attrs:{trigger:"focus",placement:"bottom","popper-class":"poptip-staff",transfer:""}},[r("Input",{attrs:{placeholder:"请选择"},on:{"on-enter":function(r){e.searchStaff(r,e.bonusList[n],t)}},model:{value:e.bonusList[n].show_num,callback:function(t){e.$set(e.bonusList[n],"show_num",t)},expression:"bonusList[index].show_num"}}),r("div",{staticClass:"staffList",attrs:{slot:"content"},slot:"content"},e._l(t.staffList,(function(i,o){return r("div",{key:o,staticClass:"staffList-item",on:{click:function(r){e.chooseStaff(e.bonusList[n],t,i)}}},[e._v("\n                "+e._s(i.serial_num+" "+i.staff_name)+"\n              ")])})))],1)]}}])}),r("el-table-column",{attrs:{align:"center",label:"指定",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Checkbox",{model:{value:e.bonusList[n].specified_switch,callback:function(t){e.$set(e.bonusList[n],"specified_switch",t)},expression:"bonusList[index].specified_switch"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"业绩"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.bonusList[n].performance_price,callback:function(t){e.$set(e.bonusList[n],"performance_price",t)},expression:"bonusList[index].performance_price"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"提成"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.bonusList[n].dividends_price,callback:function(t){e.$set(e.bonusList[n],"dividends_price",t)},expression:"bonusList[index].dividends_price"}})]}}])})],1)}))],2),r("Form",{ref:"orderForm",attrs:{model:e.orderForm,"label-width":80,"label-position":"right"}},[r("FormItem",{attrs:{label:"支付方式"}},[r("div",{staticClass:"paymentList"},e._l(Object.keys(e.curMember).length?e.memberPaymentList:e.paymentList,(function(t,n){return r("div",{key:n,staticClass:"paymentList-item"},[r("Input",{staticClass:"input-commission",attrs:{size:"large"},on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:t.amount_price,callback:function(r){e.$set(t,"amount_price",r)},expression:"item.amount_price"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(t.payment_name))])]),"赠金"===t.payment_name&&""!==t.amount_price?r("div",{staticClass:"paymentList-item-notice"},[e._v("\n              赠金折扣金额"+e._s(Number(e.presentPrice-e.discountPresentPrice).toFixed(2))+"\n            ")]):e._e()],1)})))]),r("div",{staticClass:"row-justify"},[r("FormItem",{attrs:{label:"订单日期"}},[r("DatePicker",{attrs:{type:"datetime",placeholder:"订单日期",format:"yyyy-MM-dd HH:mm:ss",readonly:e.$permissionFn.readOnly()},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.inputEnterJump(t)}},model:{value:e.order_time,callback:function(t){e.order_time=t},expression:"order_time"}})],1),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("FormItem",{attrs:{label:"手工单号"}},[r("Input",{attrs:{placeholder:"请输入手工单号",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.order_no,callback:function(t){e.$set(e.orderForm,"order_no",t)},expression:"orderForm.order_no"}})],1),r("Form-item",{attrs:{label:"手工单号是否重复"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.ignore_order_no,callback:function(t){e.$set(e.orderForm,"ignore_order_no",t)},expression:"orderForm.ignore_order_no"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),Object.keys(e.curMember).length?r("FormItem",{attrs:{label:"积分"}},[r("Input",{attrs:{placeholder:"请输入积分",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.integral,callback:function(t){e.$set(e.orderForm,"integral",t)},expression:"orderForm.integral"}})],1):e._e(),Object.keys(e.curMember).length?r("FormItem",{attrs:{label:"会员密码"}},[r("Input",{attrs:{placeholder:"请输入会员密码",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.memberPwd,callback:function(t){e.memberPwd=t},expression:"memberPwd"}})],1):e._e(),r("Form-item",{attrs:{label:"备注"}},[r("Input",{attrs:{placeholder:"请输入备注"},on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:e.orderForm.memo,callback:function(t){e.$set(e.orderForm,"memo",t)},expression:"orderForm.memo"}})],1)],1),r("div",{staticClass:"row"},[r("FormItem",{attrs:{label:"客数"}},[r("div",{staticClass:"ks"},[r("Input",{staticStyle:{width:"210px"},attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.body_count,callback:function(t){e.$set(e.orderForm,"body_count",t)},expression:"orderForm.body_count"}}),r("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.orderForm.gender,callback:function(t){e.$set(e.orderForm,"gender",t)},expression:"orderForm.gender"}},[r("Radio",{attrs:{label:0}},[e._v("女")]),r("Radio",{attrs:{label:1}},[e._v("男")])],1)],1)]),r("Form-item",{attrs:{label:"是否发送信息提醒"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.notify,callback:function(t){e.$set(e.orderForm,"notify",t)},expression:"orderForm.notify"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),r("div",{staticClass:"row"},[r("span",{staticStyle:{"flex-shrink":"0",color:"red","font-size":"22px"}},[e._v("\n        "+e._s("结算："+Number(Number(e.discountPrice)-(Number(e.presentPrice)-Number(e.discountPresentPrice))).toFixed(2))+"\n      ")]),r("Button",{staticClass:"btn-confirm",attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.loading?"提交中":"立即结账"))])],1)],1),e.isDataLoad?e._e():r("Spin",{attrs:{size:"large",fix:""}}),r("Modal",{attrs:{width:"600px","footer-hide":""},model:{value:e.resultShow,callback:function(t){e.resultShow=t},expression:"resultShow"}},[r("div",{staticClass:"modal-result"},[r("Icon",{attrs:{type:"md-checkmark-circle-outline"}}),r("span",{staticClass:"title"},[e._v("结算成功")]),1==e.result.type?r("ul",{staticClass:"detail"},[r("li",[r("span",[e._v("会员姓名：")]),r("span",[e._v(e._s(e.result.name))])]),r("li",[r("span",[e._v("手机号：")]),r("span",[e._v(e._s(e.result.phone||"未填写手机号"))])]),r("li",[r("span",[e._v("卡号：")]),r("span",[e._v(e._s(e.result.cardNo||"未填写卡号"))])]),r("li",[r("span",[e._v("结算前余额：")]),r("span",[e._v(e._s(e.result.balance))])]),r("li",[r("span",[e._v("结算后余额：")]),r("span",[e._v(e._s(e.result.balanceAfter))])]),r("li",[r("span",[e._v("欠款：")]),r("span",[e._v(e._s(e.result.debtsAfter))])])]):r("span",{staticStyle:{"margin-top":"20px","font-size":"16px"}},[e._v("\n        尊敬的客人，您本次消费"+e._s(e.result.payment)+"元\n      ")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.resultShow=!1}}},[e._v("确认")])],1)])],1)},_=[],g=(r("5df3"),r("1c4c"),r("f751"),r("ed08")),y=r("b39c"),v={props:{ruleList:{type:Object,default:function(){}},curMember:{type:Object,default:function(){}},curMemberRule:{type:Object,default:function(){}},staffSortList:{type:Array,default:function(){return[]}}},data:function(){return{isDataLoad:!1,percent:10,originalPrice:"",discount:"",discountPrice:"",presentPrice:"",discountPresentPrice:"",loading:!1,order_time:"",memberPwd:"",lastOrderNo:0,orderForm:Object(y["j"])({consume_type:0,body_count:1,gender:0}),bonusList:Object(y["g"])("tenant_speedy","快速消费"),paymentCache:{},paymentList:Object(y["k"])(),memberPaymentList:Object(y["k"])("member"),resultShow:!1,result:{},inputList:[]}},watch:{curMember:function(){this.orderForm.gender=1===this.curMember.gender?1:0,this.getLastOrderNo()},curMemberRule:function(){this.discount=this.curMemberRule.speedy,this.discountPresentPrice=Number(Object.keys(this.curMemberRule).length?this.presentPrice*Number(this.curMemberRule.giving_switch)/10:this.presentPrice).toFixed(2)},originalPrice:function(e){this.discountPrice=Number(this.discount?this.discount/this.percent*this.originalPrice:this.originalPrice).toFixed(2)},discount:function(e){this.originalPrice?this.discountPrice=Number(e?e/this.percent*this.originalPrice:this.originalPrice).toFixed(2):this.discountPrice=""},discountPrice:function(e){var t=this;Object.keys(this.curMemberRule).length&&this.pointCompute(),this.bonusList.forEach((function(e){t.computeBonu(e)})),setTimeout((function(){t.computePaymentList()}))},presentPrice:function(e){var t=this;if(Number(e)>Number(this.discountPrice))return this.presentPrice=this.discountPrice,void this.$Message.error("赠金金额不能大于折后价");this.discountPresentPrice=Number(Object.keys(this.curMemberRule).length?Number(this.presentPrice)*Number(this.curMemberRule.giving_switch)/10:this.presentPrice).toFixed(2),this.bonusList.forEach((function(e){t.computeBonu(e)})),setTimeout((function(){t.computePaymentList()}))},staffSortList:function(){var e=this;this.staffSortList.length&&(this.staffSortList.map((function(t,r){if(0!==r){var n=JSON.parse(JSON.stringify(e.bonusList[0]));n.index=r+1,e.bonusList.push(n)}})),this.watchBonus(),this.isDataLoad=!0)},order_time:function(e){"00:00:00"===Object(g["i"])(e,"{h}:{i}:{s}")&&(this.order_time=new Date(Object(g["i"])(e,"{y}-{m}-{d}")+" "+Object(g["i"])(new Date,"{h}:{i}:{s}")))}},created:function(){var e=this;this.getLastOrderNo(),this.staffSortList&&(this.staffSortList.map((function(t,r){if(0!==r){var n=JSON.parse(JSON.stringify(e.bonusList[0]));n.index=r+1,e.bonusList.push(n)}})),this.watchBonus(),this.isDataLoad=!0),this.watchPays()},methods:{getLastOrderNo:function(){var e=this;this.$api.business.getLastOrderNo().then((function(t){e.lastOrderNo=t.data?Number(t.data.order_no):0,e.orderForm.order_no=e.lastOrderNo+1}))},chooseStaff:function(e,t,r,n){e.staff_id=r.id,e.show_num=r.serial_num,e.cur_position=r.position[t.id]},matchRule:function(e){var t=this.ruleList.tenant_speedy||{};if(Object.keys(e.cur_position).length){var r=Boolean(e.cur_position.position_id);if(r&&t.hasOwnProperty(e.cur_position.position_id)&&t[e.cur_position.position_id].rule)e.rule=JSON.parse(t[e.cur_position.position_id].rule);else{if(!t.hasOwnProperty(e.cur_position.department_id)||!t[e.cur_position.department_id].rule)return this.$Message.warning("50001:当前职位并未设置消费规则，请手动输入提成及业绩"),void(e.rule={});e.rule=JSON.parse(t[e.cur_position.department_id].rule)}this.curMember.hierarchy?e.rule[this.curMember.hierarchy]?e.rule=e.rule[this.curMember.hierarchy]:e.rule["all"]?e.rule=e.rule["all"]:(this.$Message.warning("50003:当前职位并未设置对应会员消费规则，请手动输入提成及业绩"),e.rule={}):e.rule["normal"]?e.rule=e.rule["normal"]:e.rule["all"]?e.rule=e.rule["all"]:(this.$Message.warning("50002:当前职位并未设置散客消费规则，请手动输入提成及业绩"),e.rule={})}},computeBonu:function(e){if(e.staff_id||e.rule){var t=JSON.parse(JSON.stringify(e.rule)),r=Object(y["b"])(t,(1===e.rule.type?this.discountPrice:this.originalPrice)-this.presentPrice,this.discountPresentPrice,e.specified_switch);e.performance_price=r.pgSum,e.dividends_price=r.commission}},computePaymentList:function(){var e=this;Object.keys(this.curMember).length?(this.memberPaymentList.map((function(t){"余额"===t.payment_name?t.amount_price=e.discountPrice-e.presentPrice:"赠金"===t.payment_name?t.amount_price=e.discountPresentPrice:t.amount_price&&(t.amount_price=0)})),this.paymentCache=JSON.parse(JSON.stringify(this.memberPaymentList.find((function(e){return"余额"===e.payment_name}))))):(this.paymentList.map((function(t){"现金"===t.payment_name?t.amount_price=e.discountPrice-e.presentPrice:t.amount_price&&(t.amount_price=0)})),this.paymentCache=JSON.parse(JSON.stringify(this.paymentList.find((function(e){return"现金"===e.payment_name})))))},pointCompute:function(){this.orderForm.integral=Number(this.curMemberRule.consume_integral)?Number(this.discountPrice/this.curMemberRule.consume_integral).toFixed(2):0,this.$store.commit("business/setPoint",Number(this.orderForm.integral))},watchBonus:function(){var e=this,t=this;this.bonusList.forEach((function(r,n){e.bonusList[n]=new Proxy(r,{set:function(e,n,i,o){if(e[n]=i,"show_num"===n)""===e.show_num&&(e.staff_id="",e.specified_switch=!1,e.performance_price="",e.dividends_price="");else if("staff_id"===n||"cur_position"===n){if(e.staff_id&&Object.keys(e.cur_position).length)return t.matchRule(e),t.computeBonu(r),!0}else"specified_switch"===n?t.computeBonu(r):"performance_price"===n&&Object.keys(e.rule).length&&(e.dividends_price=e.performance_price?Object(y["b"])(JSON.parse(JSON.stringify(e.rule)),1===e.rule.type?this.discountPrice:this.originalPrice,0,e.specified_switch,Object.assign({},{assign:"commission",custom:{pgSum:e.performance_price}})).commission:0);return!0}})}))},watchPays:function(){var e=this,t=this.paymentList.find((function(e){return"现金"===e.payment_name})),r=this.memberPaymentList.find((function(e){return"余额"===e.payment_name}));function n(){var n;n=Object.keys(e.curMember).length?e.memberPaymentList.reduce((function(e,t){return["余额","赠金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0):e.paymentList.reduce((function(e,t){return["现金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0),Object.keys(e.paymentCache).length&&(e.paymentCache.amount_price-n<0?e.$Message.info("计算过后的值不能小于0，请自行手动修改"):Object.keys(e.curMember).length?r.amount_price=Number(e.paymentCache.amount_price-n).toFixed(2):t.amount_price=Number(e.paymentCache.amount_price-n).toFixed(2))}function i(t){e.orderForm.integral=Number(e.$store.state.business.pointCache-t).toFixed(2)}this.paymentList.forEach((function(e,t,r){["现金"].includes(e.payment_name)||(r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,n(),!0}}))})),this.memberPaymentList.forEach((function(e,t,r){["余额","赠金"].includes(e.payment_name)||(r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,n(),"积分"===e.payment_name&&i(r),!0}}))}))},submit:function(){var e=this,t=Object.keys(this.curMember).length?"memberPaymentList":"paymentList",r=Number(this.presentPrice-this.discountPresentPrice).toFixed(2);if(Number(this.originalPrice)<0)this.$Message.error("消费金额不能小于零");else if(Object.keys(this.curMember).length&&this.curMember.password&&this.memberPwd!==this.curMember.password)this.$Message.error("会员密码错误");else if(!0!==this.loading){var n=this[t].reduce((function(e,t){return t.amount_price?e+Number(t.amount_price):e}),0);if(n===Number(this.discountPrice)-r){if(Object.keys(this.curMember).length&&this.memberPaymentList.forEach((function(t){"余额"===t.payment_name&&(e.orderForm.payment_balance=Number(t.amount_price)),"赠金"===t.payment_name&&(e.orderForm.payment_giving=Number(t.amount_price)),"欠款"===t.payment_name&&(e.orderForm.payment_arrears=Number(t.amount_price))})),Object.keys(this.curMember).length){if(this.orderForm.member_id=this.curMember.id||"",this.orderForm.payment_balance>this.curMember.balance_price)return void this.$Message.error("支付失败：支付卡金大于余额");if(this.orderForm.payment_giving>this.curMember.giving_price)return void this.$Message.error("支付失败：支付赠金大于赠金余额")}this.loading=!0,this.orderForm.bonus=JSON.parse(JSON.stringify(this.bonusList)),this.orderForm.bonus=this.orderForm.bonus.filter((function(e){if(!e.staff_id)return!1;var t=e.dividends_price;return e.performance_price=e.performance_price||0,e.dividends_price=t,delete e.show_num,delete e.rule,delete e.index,!0})),this.orderForm.bonus=JSON.stringify(this.orderForm.bonus),"[]"===this.orderForm.bonus&&(this.orderForm.bonus=""),this.orderForm.payments=JSON.stringify(this[t].filter((function(t){return!!Number(t.amount_price)&&("免单"===t.payment_name&&(e.orderForm.consume_type=2),"欠款"===t.payment_name&&(e.orderForm.consume_type=1),!0)}))),"[]"===this.orderForm.payments&&(this.orderForm.payments=""),this.orderForm.alias=this.curMember.alias||"",this.orderForm.phone=this.curMember.phone||"",this.orderForm.gross_price=Number(this.discountPrice),this.orderForm.profit_price=Number(this.discountPrice)-r,this.orderForm.order_time=Object(g["i"])(""!==this.order_time?this.order_time:new Date,"{y}-{m}-{d} {h}:{i}:{s}"),Object.keys(this.curMember).length&&(this.orderForm.notify_format=Object(y["l"])("consume",this.curMember,this.orderForm)),this.$api.business.addOrder(this.orderForm).then((function(t){if(Object.keys(e.curMember).length){e.result.type=1;var r=e.curMember;e.result.name=r.alias,e.result.phone=r.phone,e.result.cardNo=r.serial_num,e.result.balance=r.balance_price,e.result.debts=r.arrears_price,e.result.balanceAfter=Number(e.result.balance-e.orderForm.payment_balance).toFixed(2),e.result.debtsAfter=Number(e.result.debts+e.orderForm.payment_arrears).toFixed(2),e.result.integralAfter=Number(e.curMember.integral)+Number(e.orderForm.integral)}else e.result.type=2,e.result.payment=e.discountPrice;e.result.originalPayment=Number(e.originalPrice),e.resultShow=!0,e.$emit("order-success",{memberRefresh:Boolean(Object.keys(e.curMember).length),type:"consume",order:e.orderForm,result:e.result}),e.reset(),e.loading=!1}),(function(t){e.$Notice.error({title:"错误",desc:"订单创建失败",duration:30}),e.loading=!1}))}else this.$Message.error("支付方式金额总和与消费金额不一致")}else this.$Message.error("上一笔订单尚未提交完成，请稍后再试")},searchStaff:function(e,t,r){var n=r.staffList.find((function(e){return t.show_num==e.serial_num}));t.show_num?n?(t.staff_id=n.id,t.cur_position=n.position[r.id],this.inputEnterJump(e)):(t.staff_id="",t.show_id="",t.cur_position={},t.rule={},this.$Message.error("没有搜索到员工")):this.inputEnterJump(e)},inputEnterJump:function(e){var t=this;this.inputList.length||(this.inputList=Array.from(document.querySelectorAll("input.ivu-input")));var r=e.srcElement;this.inputList.some((function(e,n){if(n===t.inputList.length-1)t.submit();else if(r==e)return t.inputList[n+1].focus(),!0}))},reset:function(){this.orderForm=Object(y["j"])({consume_type:0,body_count:1,gender:0}),this.paymentCache={},this.paymentList.map((function(e){e.amount_price=0})),this.memberPaymentList.map((function(e){e.amount_price=0})),this.bonusList.map((function(e){e.staff_id="",e.show_num="",e.cur_position={},e.rule=""})),this.lastOrderNo++,this.orderForm.order_no=this.lastOrderNo+1,this.originalPrice="",this.discount="",this.discountPrice="",this.presentPrice="",this.discountPresentPrice="",this.order_time="",this.memberPwd=""}}},w=v,L=(r("24d9"),Object(p["a"])(w,b,_,!1,null,"68f7381b",null));L.options.__file="consume.vue";var O=L.exports,P=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"good"},[e.isDataLoad?e._e():r("Spin",{attrs:{size:"large",fix:""}}),r("el-table",{staticClass:"table-consume-custom",staticStyle:{"margin-top":"0"},attrs:{"header-cell-class-name":"el-table-header-cell-custom",data:e.goodList,fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"编号","min-width":"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"id"},[r("Input",{attrs:{type:"number"},on:{"on-focus":function(r){e.showGoods(r,t)},"on-enter":function(r){e.searchGood(r,t.row)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.good.serial_num,callback:function(r){e.$set(t.row.good,"serial_num",r)},expression:"scope.row.good.serial_num"}}),e.goodList.length>2&&Object.keys(t.row.good).length?r("Icon",{attrs:{type:"md-close-circle"},on:{click:function(r){e.removeGood(t.$index)}}}):e._e()],1)]}}])}),r("el-table-column",{attrs:{align:"center",label:"名称","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:t.row.good.alias,callback:function(r){e.$set(t.row.good,"alias",r)},expression:"scope.row.good.alias"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"原价","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.originalPrice,callback:function(r){e.$set(t.row,"originalPrice",r)},expression:"scope.row.originalPrice"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"数量","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.qty,callback:function(r){e.$set(t.row,"qty",r)},expression:"scope.row.qty"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"折扣","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.discount,callback:function(r){e.$set(t.row,"discount",r)},expression:"scope.row.discount"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"折后价","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.discountPriceAll,callback:function(r){e.$set(t.row,"discountPriceAll",r)},expression:"scope.row.discountPriceAll"}})]}}])}),Object.keys(e.curMember).length?r("el-table-column",{attrs:{align:"center",label:"赠金","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.presentPrice,callback:function(r){e.$set(t.row,"presentPrice",r)},expression:"scope.row.presentPrice"}})]}}])}):e._e(),e._l(e.staffSortList,(function(t,n){return r("el-table-column",{key:n,attrs:{align:"center",label:t.alias}},[r("el-table-column",{attrs:{align:"center",label:"工号","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(i){return i.row.bonusList[n]?[r("Poptip",{attrs:{trigger:"focus",placement:"bottom","popper-class":"poptip-staff",transfer:""}},[r("Input",{on:{"on-enter":function(r){e.searchStaff(r,i.row.bonusList[n],t)}},model:{value:i.row.bonusList[n].show_num,callback:function(t){e.$set(i.row.bonusList[n],"show_num",t)},expression:"scope.row.bonusList[index].show_num"}}),r("div",{staticClass:"staffList",attrs:{slot:"content"},slot:"content"},e._l(t.staffList,(function(o,s){return r("div",{key:s,staticClass:"staffList-item",on:{click:function(r){e.chooseStaff(i.row.bonusList[n],t,o)}}},[e._v("\n                "+e._s(o.serial_num+" "+o.staff_name)+"\n              ")])})))],1)]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"指定","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Checkbox",{model:{value:t.row.bonusList[n].specified_switch,callback:function(r){e.$set(t.row.bonusList[n],"specified_switch",r)},expression:"scope.row.bonusList[index].specified_switch"}})]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"业绩","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.bonusList[n].performance_price,callback:function(r){e.$set(t.row.bonusList[n],"performance_price",r)},expression:"scope.row.bonusList[index].performance_price"}})]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"提成","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.bonusList[n].dividends_price,callback:function(r){e.$set(t.row.bonusList[n],"dividends_price",r)},expression:"scope.row.bonusList[index].dividends_price"}})]:void 0}}])})],1)}))],2),r("Form",{ref:"orderForm",attrs:{model:e.orderForm,"label-width":80,"label-position":"right"}},[r("FormItem",{attrs:{label:"支付方式"}},[r("div",{staticClass:"paymentList"},e._l(Object.keys(e.curMember).length?e.memberPaymentList:e.paymentList,(function(t,n){return r("div",{key:n,staticClass:"paymentList-item"},[r("Input",{staticClass:"input-commission",attrs:{size:"large"},on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:t.amount_price,callback:function(r){e.$set(t,"amount_price",r)},expression:"item.amount_price"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(t.payment_name))])]),"赠金"===t.payment_name&&""!==t.amount_price?r("div",{staticClass:"paymentList-item-notice"},[e._v("\n            赠金折扣金额"+e._s(Number(e.result.presentPriceAll-e.result.discountPresentPriceAll).toFixed(2))+"\n          ")]):e._e()],1)})))]),r("div",{staticClass:"row-justify"},[r("FormItem",{attrs:{label:"订单日期"}},[r("DatePicker",{attrs:{type:"datetime",placeholder:"订单日期",format:"yyyy-MM-dd HH:mm:ss",readonly:e.$permissionFn.readOnly()},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.inputEnterJump(t)}},model:{value:e.order_time,callback:function(t){e.order_time=t},expression:"order_time"}})],1),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("FormItem",{attrs:{label:"手工单号"}},[r("Input",{attrs:{placeholder:"请输入手工单号",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.order_no,callback:function(t){e.$set(e.orderForm,"order_no",t)},expression:"orderForm.order_no"}})],1),r("Form-item",{attrs:{label:"手工单号是否重复"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.ignore_order_no,callback:function(t){e.$set(e.orderForm,"ignore_order_no",t)},expression:"orderForm.ignore_order_no"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),Object.keys(e.curMember).length?r("FormItem",{attrs:{label:"积分"}},[r("Input",{attrs:{placeholder:"请输入积分",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.integral,callback:function(t){e.$set(e.orderForm,"integral",t)},expression:"orderForm.integral"}})],1):e._e(),Object.keys(e.curMember).length?r("FormItem",{attrs:{label:"会员密码"}},[r("Input",{attrs:{placeholder:"请输入会员密码",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.memberPwd,callback:function(t){e.memberPwd=t},expression:"memberPwd"}})],1):e._e(),r("Form-item",{attrs:{label:"备注"}},[r("Input",{attrs:{placeholder:"请输入备注"},on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:e.orderForm.memo,callback:function(t){e.$set(e.orderForm,"memo",t)},expression:"orderForm.memo"}})],1)],1),r("div",{staticClass:"row"},[r("FormItem",{attrs:{label:"客数"}},[r("div",{staticClass:"ks"},[r("Input",{staticStyle:{width:"210px"},attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.body_count,callback:function(t){e.$set(e.orderForm,"body_count",t)},expression:"orderForm.body_count"}}),r("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.orderForm.gender,callback:function(t){e.$set(e.orderForm,"gender",t)},expression:"orderForm.gender"}},[r("Radio",{attrs:{label:0}},[e._v("女")]),r("Radio",{attrs:{label:1}},[e._v("男")])],1)],1)]),r("Form-item",{attrs:{label:"是否发送信息提醒"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.notify,callback:function(t){e.$set(e.orderForm,"notify",t)},expression:"orderForm.notify"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),r("div",{staticClass:"row"},[r("span",{staticStyle:{"flex-shrink":"0",color:"red","font-size":"22px"}},[e._v(e._s("结算："+e.orderForm.gross_price))]),r("Button",{staticClass:"btn-confirm",attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.loading?"提交中":"立即结账"))])],1)],1),r("el-popover",{attrs:{id:"goodListPop",placement:"bottom",trigger:"manual"},model:{value:e.popGoodShow,callback:function(t){e.popGoodShow=t},expression:"popGoodShow"}},[r("el-tabs",{model:{value:e.curGoodType,callback:function(t){e.curGoodType=t},expression:"curGoodType"}},[r("el-tab-pane",{attrs:{label:"项目",name:"services"}},e._l(e.projectList,(function(t,n){return r("div",{key:n,staticClass:"chooseList-wrapper"},[r("el-tooltip",{attrs:{effect:"dark",content:t.alias,placement:"bottom",disabled:t.alias.length<=10}},[r("div",{staticClass:"title"},[e._v(e._s(t.alias))])]),r("div",{staticClass:"chooseList"},e._l(t.children,(function(n,i){return r("div",{key:i,on:{click:function(r){e.selectGood(n,t)}}},[r("el-tooltip",{attrs:{effect:"dark",content:n.serial_num+" "+n.alias,placement:"bottom",disabled:(""+n.serial_num+n.alias).length<=15}},[r("div",{staticClass:"chooseList-item"},[r("span",{staticClass:"num"},[e._v(e._s(n.serial_num))]),r("span",{staticClass:"name"},[e._v(e._s(n.alias))])])])],1)})))],1)}))),r("el-tab-pane",{attrs:{label:"商品",name:"commodity"}},e._l(e.commodityList,(function(t,n){return r("div",{key:n,staticClass:"chooseList-wrapper"},[r("el-tooltip",{attrs:{effect:"dark",content:t.alias,placement:"bottom",disabled:t.alias.length<=10}},[r("div",{staticClass:"title"},[e._v(e._s(t.alias))])]),r("div",{staticClass:"chooseList"},e._l(t.children,(function(n,i){return r("div",{key:i,on:{click:function(r){e.selectGood(n,t)}}},[r("el-tooltip",{attrs:{effect:"dark",content:n.serial_num+" "+n.alias,placement:"bottom",disabled:(""+n.serial_num+n.alias).length<=15}},[r("div",{staticClass:"chooseList-item"},[r("span",{staticClass:"num"},[e._v(e._s(n.serial_num))]),r("span",{staticClass:"name"},[e._v(e._s(n.alias))])])])],1)})))],1)})))],1)],1),r("Modal",{attrs:{width:"600px","footer-hide":""},model:{value:e.resultShow,callback:function(t){e.resultShow=t},expression:"resultShow"}},[r("div",{staticClass:"modal-result"},[r("Icon",{attrs:{type:"md-checkmark-circle-outline"}}),r("span",{staticClass:"title"},[e._v("结算成功")]),1==e.result.type?r("ul",{staticClass:"detail"},[r("li",[r("span",[e._v("会员姓名：")]),r("span",[e._v(e._s(e.result.name))])]),r("li",[r("span",[e._v("手机号：")]),r("span",[e._v(e._s(e.result.phone||"未填写手机号"))])]),r("li",[r("span",[e._v("卡号：")]),r("span",[e._v(e._s(e.result.cardNo||"未填写卡号"))])]),r("li",[r("span",[e._v("结算前余额：")]),r("span",[e._v(e._s(e.result.balance))])]),r("li",[r("span",[e._v("结算后余额：")]),r("span",[e._v(e._s(e.result.balanceAfter))])]),r("li",[r("span",[e._v("欠款：")]),r("span",[e._v(e._s(e.result.debtsAfter))])])]):r("span",{staticStyle:{"margin-top":"20px","font-size":"16px"}},[e._v("\n        尊敬的客人，您本次消费"+e._s(e.result.discountPriceAll)+"元\n      ")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.resultShow=!1}}},[e._v("确认")])],1)])],1)},S=[],N={props:{ruleList:{type:Object,default:function(){}},curMember:{type:Object,default:function(){}},curMemberRule:{type:Object,default:function(){}},staffSortList:{type:Array,default:function(){return[]}}},data:function(){return{isDataLoad:!1,loading:!1,order_time:"",memberPwd:"",lastOrderNo:0,orderForm:Object(y["j"])({consume_type:0,body_count:1,gender:0}),bonusList:Object(y["g"])(),paymentCache:{},paymentList:Object(y["k"])(),memberPaymentList:Object(y["k"])("member"),categoryList:[],commodityList:[],projectList:[],goodList:Object(y["i"])(),popGoodShow:!1,curGoodIndex:0,curGoodType:"services",disableGoodsFn:"",messageChokeFn:"",inputList:[],resultShow:!1,result:{}}},watch:{curMember:function(){var e=this;this.goodList.map((function(t){Object.keys(t.good).length&&(t.bonusList.map((function(r){e.matchRule(r,t.type,t.category.id,t.good.id)})),e.computeGoodItem(t))})),this.orderForm.gender=1===this.curMember.gender?1:0,this.getLastOrderNo()},staffSortList:function(){var e=this;this.staffSortList.length&&this.initBonusListByPosition().then((function(){e.$set(e.goodList,0,e.createGoodItem()),e.isDataLoad=!0}))},order_time:function(e){"00:00:00"===Object(g["i"])(e,"{h}:{i}:{s}")&&(this.order_time=new Date(Object(g["i"])(e,"{y}-{m}-{d}")+" "+Object(g["i"])(new Date,"{h}:{i}:{s}")))}},created:function(){var e=this;this.init(),this.staffSortList&&this.initBonusListByPosition().then((function(){e.$set(e.goodList,0,e.createGoodItem()),e.isDataLoad=!0})),Object.keys(this.curMember).length&&(this.orderForm.gender=1===this.curMember.gender?1:0),this.watchPays()},methods:{init:function(){this.getCategoryList(),this.getLastOrderNo()},getCategoryList:function(){var e=this;return this.$api.common.getCategory().then((function(t){e.categoryList=t.data||{},e.commodityList=e.categoryList.tenant_commodity||{},e.projectList=e.categoryList.tenant_project||{},e.$api.common.getCommodity().then((function(t){Object.keys(t.data).map((function(e){t.data[e]=t.data[e]?Object.values(t.data[e]).filter((function(e){return 0===e.status})):[]})),Object.keys(e.commodityList).map((function(r){e.commodityList[r].children=t.data[r]||[]})),e.commodityList=Object.values(e.commodityList)})),e.$api.common.getProject().then((function(t){Object.keys(t.data).map((function(e){t.data[e]=t.data[e]?Object.values(t.data[e]).filter((function(e){return 0===e.status})):[]})),Object.keys(e.projectList).map((function(r){e.projectList[r].children=t.data[r]||[]})),e.projectList=Object.values(e.projectList)}))}))},getLastOrderNo:function(){var e=this;return this.$api.business.getLastOrderNo().then((function(t){e.lastOrderNo=t.data?Number(t.data.order_no):0,e.orderForm.order_no=e.lastOrderNo+1}))},initBonusListByPosition:function(){var e=this;return new Promise((function(t){e.staffSortList.map((function(t,r){if(0!==r){var n=JSON.parse(JSON.stringify(e.bonusList[0]));n.index=r+1,e.bonusList.push(n)}})),t()}))},createGoodItem:function(){var e=Object(y["h"])();return e.bonusList=JSON.parse(JSON.stringify(this.bonusList)),this.watchGood(e)},computeGoodItem:function(e){var t=Object(y["a"])({type:e.type,num:e.qty,good:e.good,memberRule:this.curMemberRule});e.originalPrice=t.originalPrice,e.discount=t.discount,e.discountPrice=t.discountPrice,e.originalPriceAll=t.originalPriceAll,e.discountPriceAll=t.discountPriceAll},computeGoodItemBoun:function(e,t){if(e.staff_id||e.rule){var r=JSON.parse(JSON.stringify(e.rule)),n=Object(y["b"])(r,(1===e.rule.type?t.discountPriceAll:t.originalPriceAll)-t.presentPrice,t.presentPrice||0,e.specified_switch);e.performance_price=n.pgSum,e.dividends_price=n.commission}},computePriceAll:function(){this.result.discountPriceAll=this.goodList.reduce((function(e,t){return t.discountPriceAll&&(e+=Number(t.discountPriceAll)),e}),0),this.result.presentPriceAll=this.goodList.reduce((function(e,t){return t.presentPrice&&(e+=Number(t.presentPrice)),e}),0),this.result.discountPresentPriceAll=this.goodList.reduce((function(e,t){return t.discountPresentPrice&&(e+=Number(t.discountPresentPrice)),e}),0),this.result.discountPriceAll=(Number(this.result.discountPriceAll)-Number(this.result.presentPriceAll)).toFixed(2),Object.keys(this.curMember).length?(this.memberPaymentList.map((function(e){e.amount_price&&(e.amount_price=0)})),this.memberPaymentList.find((function(e){return"余额"===e.payment_name})).amount_price=this.result.discountPriceAll,this.memberPaymentList.find((function(e){return"赠金"===e.payment_name})).amount_price=this.result.discountPresentPriceAll,this.paymentCache=JSON.parse(JSON.stringify(this.memberPaymentList.find((function(e){return"余额"===e.payment_name}))))):(this.paymentList.map((function(e){e.amount_price&&(e.amount_price=0)})),this.paymentList.find((function(e){return"现金"===e.payment_name})).amount_price=this.result.discountPriceAll,this.paymentCache=JSON.parse(JSON.stringify(this.paymentList.find((function(e){return"现金"===e.payment_name}))))),Object.keys(this.curMember).length&&(this.orderForm.integral=Number(this.curMemberRule.consume_integral)?Number((this.result.discountPriceAll+this.result.presentPriceAll)/this.curMemberRule.consume_integral).toFixed(2):0,this.$store.commit("business/setPoint",Number(this.orderForm.integral))),this.orderForm.gross_price=Number(this.result.discountPriceAll)+Number(this.result.discountPresentPriceAll)},matchRule:function(e,t,r,n){this.messageChokeFn||(this.messageChokeFn=Object(g["e"])());var i="commodity"===t,o=(i?this.ruleList.tenant_commodity:this.ruleList.tenant_project)||{};if(Object.keys(e.cur_position).length){var s=Boolean(e.cur_position.position_id);if(s&&o.hasOwnProperty(e.cur_position.position_id)&&o[e.cur_position.position_id].rule)e.rule=JSON.parse(o[e.cur_position.position_id].rule);else{if(!o.hasOwnProperty(e.cur_position.department_id)||!o[e.cur_position.department_id].rule)return this.messageChokeFn({type:"warning",content:"50001:当前职位并未设置".concat(i?"商品":"服务项目","规则，请手动输入提成及业绩")}),void(e.rule={});e.rule=JSON.parse(o[e.cur_position.department_id].rule)}if(this.curMember.hierarchy)if(e.rule[this.curMember.hierarchy])e.rule=e.rule[this.curMember.hierarchy];else{if(!e.rule["all"])return this.messageChokeFn({type:"warning",content:"50003:当前职位并未设置会员".concat(i?"商品":"服务项目","规则，请手动输入提成及业绩")}),void(e.rule={});e.rule=e.rule["all"]}else if(e.rule["normal"])e.rule=e.rule["normal"];else{if(!e.rule["all"])return this.messageChokeFn({type:"warning",content:"50002:当前职位并未设置散客".concat(i?"商品":"服务项目","规则，请手动输入提成及业绩")}),void(e.rule={});e.rule=e.rule["all"]}if(!r||!n)return void(e.rule={});if(!e.rule[r])return this.messageChokeFn({type:"warning",content:"50004:当前职位并未设置".concat(i?"商品":"服务项目","规则，请手动输入提成及业绩")}),void(e.rule={});e.rule=e.rule[r],e.rule[n]?e.rule=e.rule[n]:(this.messageChokeFn({type:"warning",content:"50005:当前职位并未设置该".concat(i?"商品":"服务项目","规则，请手动输入提成及业绩")}),e.rule={})}},watchGood:function(e){var t=this;return e=new Proxy(e,{set:function(n,i,o,s){return n[i]=o,"good"===i&&n.bonusList.map((function(r){t.matchRule(r,n.type,n.category.id,n.good.id),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))})),"qty"===i&&(r(n),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))),"originalPrice"===i&&(n.discountPrice=Number(n.discount?n.discount/y["f"]*n.originalPrice:n.originalPrice).toFixed(2),r(n),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))),"discount"===i&&(n.originalPrice?n.discountPrice=Number(n[i]?n[i]/y["f"]*n.originalPrice:n.originalPrice).toFixed(2):n.discountPrice="",r(n),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))),"discountPriceAll"===i&&(t.$nextTick((function(){t.computePriceAll()})),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))),"presentPrice"===i&&(Number(n[i])>Number(n.discountPriceAll)?(setTimeout((function(){n.presentPrice=n.discountPriceAll,t.$nextTick((function(){n.discountPresentPrice=Number(Object.keys(t.curMemberRule).length?n.presentPrice*t.curMemberRule.giving_switch/y["f"]:n.presentPrice).toFixed(2),t.$nextTick((function(){t.computePriceAll(),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))}))}))})),t.$Message.error("赠金不能大于折后价")):t.$nextTick((function(){n.discountPresentPrice=Number(Object.keys(t.curMemberRule).length?n.presentPrice*t.curMemberRule.giving_switch/y["f"]:n.presentPrice).toFixed(2),t.$nextTick((function(){t.computePriceAll(),e.bonusList.forEach((function(r){t.computeGoodItemBoun(r,e)}))}))}))),!0}}),e.bonusList.forEach((function(r,n){e.bonusList[n]=new Proxy(r,{set:function(n,i,o,s){if(n[i]=o,"show_num"===i)""===n.show_num&&(n.staff_id="",n.specified_switch=!1,n.performance_price="",n.dividends_price="");else if("staff_id"===i||"cur_position"===i){if(n.staff_id&&Object.keys(n.cur_position).length)return t.matchRule(r,e.type,e.category.id,e.good.id),t.computeGoodItemBoun(n,e),!0}else"specified_switch"===i?t.computeGoodItemBoun(n,e):"performance_price"===i&&Object.keys(n.rule).length&&(n.dividends_price=n.performance_price?Object(y["b"])(JSON.parse(JSON.stringify(n.rule)),1===n.rule.type?e.discountPrice:e.originalPrice,0,n.specified_switch,Object.assign({},{assign:"commission",custom:{pgSum:n.performance_price}})).commission:0);return!0}})})),e;function r(e){e.originalPriceAll=Number(e.originalPrice*e.qty).toFixed(2),e.discountPriceAll=Number(e.discountPrice*e.qty).toFixed(2),e.discountPresentPrice=Number(Object.keys(t.curMemberRule).length?e.presentPrice*t.curMemberRule.giving_switch/100:e.presentPrice).toFixed(2),t.$nextTick((function(){t.computePriceAll()}))}},watchPays:function(){var e=this,t=this.paymentList.find((function(e){return"现金"===e.payment_name})),r=this.memberPaymentList.find((function(e){return"余额"===e.payment_name}));function n(){var n;n=Object.keys(e.curMember).length?e.memberPaymentList.reduce((function(e,t){return["余额","赠金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0):e.paymentList.reduce((function(e,t){return["现金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0),Object.keys(e.paymentCache).length&&(e.paymentCache.amount_price-n<0?e.$Message.info("计算过后的值不能小于0，请自行手动修改"):Object.keys(e.curMember).length?r.amount_price=Number(e.paymentCache.amount_price-n).toFixed(2):t.amount_price=Number(e.paymentCache.amount_price-n).toFixed(2))}function i(t){e.orderForm.integral=Number(e.$store.state.business.pointCache-t).toFixed(2)}this.paymentList.forEach((function(e,t,r){["现金"].includes(e.payment_name)||(r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,n(),!0}}))})),this.memberPaymentList.forEach((function(e,t,r){["余额","赠金"].includes(e.payment_name)||(r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,n(),"积分"===e.payment_name&&i(r),!0}}))}))},submit:function(){var e=this,t=Object.keys(this.curMember).length?"memberPaymentList":"paymentList";if(Object.keys(this.curMember).length&&this.curMember.password&&this.memberPwd!==this.curMember.password)this.$Message.error("会员密码错误");else if(!0!==this.loading){var r=this[t].reduce((function(t,r){return"余额"===r.payment_name&&(e.orderForm.payment_balance=Number(r.amount_price)),"赠金"===r.payment_name&&(e.orderForm.payment_giving=Number(r.amount_price)),"欠款"===r.payment_name&&(e.orderForm.payment_arrears=Number(r.amount_price)),t+(Number(r.amount_price)||0)}),0);if(this.orderForm.gross_price<0)this.$Message.error("消费金额不能小于零");else if(r===this.orderForm.gross_price){if(Object.keys(this.curMember).length){if(this.orderForm.member_id=this.curMember.id||"",this.orderForm.payment_balance>this.curMember.balance_price)return void this.$Message.error("支付失败：支付卡金大于余额");if(this.orderForm.payment_giving>this.curMember.giving_price)return void this.$Message.error("支付失败：支付赠金大于赠金余额")}this.loading=!0,this.orderForm.profit_price=this.orderForm.gross_price-this.goodList.reduce((function(e,t){return t.good.cost_price&&t.qty&&(e+=t.good.cost_price*t.qty),e}),0),this.orderForm.payments=JSON.stringify(this[t].filter((function(t){return!!Number(t.amount_price)&&("免单"===t.payment_name&&(e.orderForm.consume_type=2),"欠款"===t.payment_name&&(e.orderForm.consume_type=1),!0)}))),this.orderForm.alias=this.curMember.alias||"",this.orderForm.phone=this.curMember.phone||"",this.orderForm.order_time=Object(g["i"])(""!==this.order_time?this.order_time:new Date,"{y}-{m}-{d} {h}:{i}:{s}"),this.orderForm.bonus=JSON.stringify(i.call(this));var n=s.call(this);this.orderForm.commodity_surplus=n.commodity_surplus,this.orderForm.project_surplus=n.project_surplus,this.orderForm.shopping_cart=JSON.stringify(o.call(this)),"[]"===this.orderForm.payments&&(this.orderForm.payments=""),"[]"===this.orderForm.bonus&&(this.orderForm.bonus=""),"[]"===this.orderForm.commodity_surplus&&(this.orderForm.commodity_surplus=""),"[]"===this.orderForm.project_surplus&&(this.orderForm.project_surplus=""),"[]"===this.orderForm.shopping_cart&&(this.orderForm.shopping_cart=""),Object.keys(this.curMember).length&&(this.orderForm.notify_format=Object(y["l"])("good",this.curMember,Object.assign({},this.orderForm,{goodList:this.goodList}))),this.$api.business.addOrder(this.orderForm).then((function(t){if(Object.keys(e.curMember).length){e.result.type=1;var r=e.curMember;e.result.name=r.alias,e.result.phone=r.phone,e.result.balance=r.balance_price,e.result.cardNo=r.serial_num,e.result.debts=r.arrears_price,e.result.balanceAfter=Number(e.result.balance-e.orderForm.payment_balance).toFixed(2),e.result.debtsAfter=Number(e.result.debts+e.orderForm.payment_arrears).toFixed(2),e.result.integralAfter=Number(e.curMember.integral)+Number(e.orderForm.integral)}else e.result.type=2;e.resultShow=!0,e.loading=!1,e.$emit("order-success",{memberRefresh:Boolean(Object.keys(e.curMember).length),type:"good",order:e.orderForm,result:e.result}),e.reset()}),(function(t){e.$Notice.error({title:"错误",desc:"订单创建失败",duration:30}),e.loading=!1}))}else this.$Message.error("支付方式金额总和与消费金额不一致")}else this.$Message.error("上一笔订单尚未提交完成，请稍后再试");function i(){var e=[];return this.goodList.map((function(t,r){e=e.concat(JSON.parse(JSON.stringify(t.bonusList.filter((function(e){if(!e.staff_id)return!1;var t=e.dividends_price;return e.performance_price=e.performance_price||0,e.dividends_price=t,delete e.show_num,delete e.rule,delete e.index,!0})))))})),e}function o(){var e=[];return this.goodList.map((function(t,r){if(t.good.id){var n=JSON.parse(JSON.stringify(t));delete n.bonusList,e.push(n)}})),e}function s(){var e={commodity_surplus:[],project_surplus:[]};return this.goodList.map((function(t){if(Object.keys(t.good).length&&t.good.id)if("commodity"===t.type){var r=e.commodity_surplus.find((function(e){return e.self_id===t.good.id}));r?(r.qty+=Number(t.qty),r.price+=Number(t.discountPriceAll)):e.commodity_surplus.push({self_id:Number(t.good.id),qty:Number(t.qty),type:"tenant_orders",price:Number(t.discountPriceAll)})}else{var n=e.project_surplus.find((function(e){return e.self_id===t.good.id}));n?(n.qty+=Number(t.qty),n.price+=Number(t.discountPriceAll)):e.project_surplus.push({self_id:Number(t.good.id),qty:Number(t.qty),type:"tenant_orders",price:Number(t.discountPriceAll)})}})),Object.keys(e).map((function(t){e[t]=JSON.stringify(e[t])})),e}},showGoods:function(e,t){this.curGoodIndex=t.$index;var r=e.srcElement,n=document.querySelector("#goodListPop"),i=s(r),o=a(r);function s(e){var t=e.offsetTop;return e.classList.contains("good")?0:(null!=e.offsetParent&&(t+=s(e.offsetParent)),t)}function a(e){var t=e.offsetLeft;return e.classList.contains("good")?0:(null!=e.offsetParent&&(t+=a(e.offsetParent)),t)}n.style.top="".concat(i+r.offsetHeight+10,"px"),n.style.left="".concat(o,"px"),this.popGoodShow=!0,this.disableGoodsFn&&document.removeEventListener("click",this.disableGoodsFn),this.disableGoodsFn=this.disableGoods(r,n)},disableGoods:function(e,t){var r=this;function n(i){i&&(i.path.some((function(t){return t===e}))||i.path.some((function(e){return e===t}))||(r.popGoodShow=!1,document.removeEventListener("click",n)))}return document.addEventListener("click",n),n},selectGood:function(e,t){var r=this;function n(){return this.goodList.reduce((function(e,t){return e<t.index?t.index:e}),0)+1}this.popGoodShow=!1,this.goodList[this.curGoodIndex].index=n.call(this),this.goodList[this.curGoodIndex].type=this.curGoodType,this.goodList[this.curGoodIndex].category=t,this.goodList[this.curGoodIndex].good=JSON.parse(JSON.stringify(e)),this.goodList[this.curGoodIndex].qty=1,this.goodList[this.curGoodIndex].bonusList.map((function(t){t.type="commodity"===r.curGoodType?"tenant_commodity":"tenant_project",t.source_alias=e.alias,t.source_id=e.id,t.source_weight=r.goodList[r.curGoodIndex].index})),this.computeGoodItem(this.goodList[this.curGoodIndex]),this.goodList.some((function(e){return!Object.keys(e.good).length}))||(this.goodList.push(this.createGoodItem()),this.$nextTick(function(){this.inputList=Array.from(document.querySelector(".good").querySelectorAll("input.ivu-input"))}.bind(this))),document.removeEventListener("click",this.disableGoodsFn)},searchGood:function(e,t){var r=this,n="commodity"===this.curGoodType,i=n?this.commodityList:this.projectList,o=t.good.serial_num;if(!o)return this.popGoodShow=!1,document.removeEventListener("click",this.disableGoodsFn),void this.inputEnterJump(e);i.some((function(e){return e.children.some((function(t){if(o==t.serial_num)return r.selectGood(t,e),!0}))}))?this.inputEnterJump(e):(t.type="",t.qty="",t.good={},this.computeGoodItem(this.goodList[this.curGoodIndex]),this.$Message.error("没有搜索到".concat(n?"商品":"服务项目")))},removeGood:function(e){this.computeGoodItem(this.goodList[e]),this.goodList.splice(e,1)},chooseStaff:function(e,t,r,n){e.staff_id=r.id,e.show_num=r.serial_num,e.cur_position=r.position[t.id]},searchStaff:function(e,t,r){var n=r.staffList.find((function(e){return t.show_num==e.serial_num}));t.show_num?n?(t.staff_id=n.id,t.cur_position=n.position[r.id],this.inputEnterJump(e)):(t.staff_id="",t.show_id="",t.cur_position={},t.rule={},this.$Message.error("没有搜索到员工")):this.inputEnterJump(e)},inputEnterJump:function(e){var t=this;this.inputList.length||(this.inputList=Array.from(document.querySelector(".good").querySelectorAll("input.ivu-input")));var r=e.srcElement;this.inputList.some((function(e,n){if(n===t.inputList.length-1)t.submit();else if(r==e)return t.inputList[n+1].focus(),!0}))},reset:function(){this.goodList=Object(y["i"])(),this.$set(this.goodList,0,this.createGoodItem()),this.paymentCache={},this.paymentList.map((function(e){e.amount_price=0})),this.memberPaymentList.map((function(e){e.amount_price=0})),this.orderForm=Object(y["j"])({consume_type:0,body_count:1,gender:0}),this.lastOrderNo++,this.orderForm.order_no=this.lastOrderNo+1,this.order_time="",this.memberPwd=""}}},k=N,F=(r("a29b"),Object(p["a"])(k,P,S,!1,null,"488c5d4a",null));F.options.__file="good.vue";var D=F.exports,T=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"count"},[e.isDataLoad?e._e():r("Spin",{attrs:{size:"large",fix:""}}),r("el-table",{staticClass:"table-consume-custom",staticStyle:{"margin-top":"0"},attrs:{"header-cell-class-name":"el-table-header-cell-custom",data:e.goodList,fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"编号","min-width":"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"id"},[r("Input",{attrs:{type:"number"},on:{"on-focus":function(r){e.showGoods(r,t)},"on-enter":function(r){e.searchGood(r,t.row)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.good.id,callback:function(r){e.$set(t.row.good,"id",r)},expression:"scope.row.good.id"}}),e.goodList.length>2&&Object.keys(t.row.good).length?r("Icon",{attrs:{type:"md-close-circle"},on:{click:function(r){e.removeGood(t.$index)}}}):e._e()],1)]}}])}),r("el-table-column",{attrs:{align:"center",label:"名称","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"name"},[r("Input",{on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:t.row.good.alias,callback:function(r){e.$set(t.row.good,"alias",r)},expression:"scope.row.good.alias"}}),Object.keys(t.row.good).length?r("a",{staticClass:"useLink",on:{click:function(r){e.useCount(t.row,"buy")}}},[e._v("使用")]):e._e()],1)]}}])}),r("el-table-column",{attrs:{align:"center",label:"原价","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.originalPrice,callback:function(r){e.$set(t.row,"originalPrice",r)},expression:"scope.row.originalPrice"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"数量","min-width":"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.qty,callback:function(r){e.$set(t.row,"qty",r)},expression:"scope.row.qty"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"折扣","min-width":"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.discount,callback:function(r){e.$set(t.row,"discount",r)},expression:"scope.row.discount"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"折后价","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.discountPriceAll,callback:function(r){e.$set(t.row,"discountPriceAll",r)},expression:"scope.row.discountPriceAll"}})]}}])}),Object.keys(e.curMember).length?r("el-table-column",{attrs:{align:"center",label:"赠金","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.presentPrice,callback:function(r){e.$set(t.row,"presentPrice",r)},expression:"scope.row.presentPrice"}})]}}])}):e._e(),e._l(e.staffSortList,(function(t,n){return r("el-table-column",{key:n,attrs:{align:"center",label:t.alias}},[r("el-table-column",{attrs:{align:"center",label:"工号","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(i){return i.row.bonusList[n]?[r("Poptip",{attrs:{trigger:"focus",placement:"bottom","popper-class":"poptip-staff",transfer:""}},[r("Input",{on:{"on-enter":function(r){e.searchStaff(r,i.row.bonusList[n],t)}},model:{value:i.row.bonusList[n].show_num,callback:function(t){e.$set(i.row.bonusList[n],"show_num",t)},expression:"scope.row.bonusList[index].show_num"}}),r("div",{staticClass:"staffList",attrs:{slot:"content"},slot:"content"},e._l(t.staffList,(function(o,s){return r("div",{key:s,staticClass:"staffList-item",on:{click:function(r){e.chooseStaff(i.row.bonusList[n],t,o)}}},[e._v("\n                "+e._s(o.serial_num+" "+o.staff_name)+"\n              ")])})))],1)]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"指定",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Checkbox",{model:{value:t.row.bonusList[n].specified_switch,callback:function(r){e.$set(t.row.bonusList[n],"specified_switch",r)},expression:"scope.row.bonusList[index].specified_switch"}})]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"业绩","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.bonusList[n].performance_price,callback:function(r){e.$set(t.row.bonusList[n],"performance_price",r)},expression:"scope.row.bonusList[index].performance_price"}})]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"提成","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.bonusList[n].dividends_price,callback:function(r){e.$set(t.row.bonusList[n],"dividends_price",r)},expression:"scope.row.bonusList[index].dividends_price"}})]:void 0}}])})],1)}))],2),e.countUseList.length?r("el-table",{staticClass:"table-consume-custom",attrs:{"header-cell-class-name":"el-table-header-cell-custom",data:e.countUseList,fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"来源","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return["countBuyUse"===t.row.type?r("span",[e._v("购买订单")]):e._e(),"countBoughtUse"===t.row.type?r("span",[e._v("已购订单")]):e._e()]}}])}),r("el-table-column",{attrs:{align:"center",label:"编号","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.good.id)+"\n      ")]}}])}),r("el-table-column",{attrs:{align:"center",label:"名称","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.good.alias)+"\n      ")]}}])}),r("el-table-column",{attrs:{align:"center",label:"使用次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.useTimes,callback:function(r){e.$set(t.row,"useTimes",e._n(r))},expression:"scope.row.useTimes"}})]}}])}),e._l(e.staffSortList,(function(t,n){return r("el-table-column",{key:n,attrs:{align:"center",label:t.alias}},[r("el-table-column",{attrs:{align:"center",label:"工号","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(i){return i.row.bonusList[n]?[r("Poptip",{attrs:{trigger:"focus",placement:"bottom","popper-class":"poptip-staff",transfer:""}},[r("Input",{on:{"on-enter":function(r){e.searchStaff(r,i.row.bonusList[n],t)}},model:{value:i.row.bonusList[n].show_num,callback:function(t){e.$set(i.row.bonusList[n],"show_num",t)},expression:"scope.row.bonusList[index].show_num"}}),r("div",{staticClass:"staffList",attrs:{slot:"content"},slot:"content"},e._l(t.staffList,(function(o,s){return r("div",{key:s,staticClass:"staffList-item",on:{click:function(r){e.chooseStaff(i.row.bonusList[n],t,o)}}},[e._v("\n                "+e._s(o.serial_num+" "+o.staff_name)+"\n              ")])})))],1)]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"指定",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Checkbox",{model:{value:t.row.bonusList[n].specified_switch,callback:function(r){e.$set(t.row.bonusList[n],"specified_switch",r)},expression:"scope.row.bonusList[index].specified_switch"}})]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"业绩","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.bonusList[n].performance_price,callback:function(r){e.$set(t.row.bonusList[n],"performance_price",r)},expression:"scope.row.bonusList[index].performance_price"}})]:void 0}}])}),r("el-table-column",{attrs:{align:"center",label:"提成","min-width":"70"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.bonusList[n]?[r("Input",{attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.row.bonusList[n].dividends_price,callback:function(r){e.$set(t.row.bonusList[n],"dividends_price",r)},expression:"scope.row.bonusList[index].dividends_price"}})]:void 0}}])})],1)}))],2):e._e(),r("Form",{ref:"orderForm",attrs:{model:e.orderForm,"label-width":80,"label-position":"right"}},[r("FormItem",{attrs:{label:"支付方式"}},[r("div",{staticClass:"paymentList"},e._l(Object.keys(e.curMember).length?e.memberPaymentList:e.paymentList,(function(t,n){return r("div",{key:n,staticClass:"paymentList-item"},[r("Input",{staticClass:"input-commission",attrs:{size:"large",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.amount_price,callback:function(r){e.$set(t,"amount_price",r)},expression:"item.amount_price"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(t.payment_name))])]),"赠金"===t.payment_name&&""!==t.amount_price?r("div",{staticClass:"paymentList-item-notice"},[e._v("\n            赠金折扣金额"+e._s(Number(e.result.presentPriceAll-e.result.discountPresentPriceAll).toFixed(2))+"\n          ")]):e._e()],1)})))]),r("div",{staticClass:"row-justify"},[r("FormItem",{attrs:{label:"订单日期"}},[r("DatePicker",{attrs:{type:"datetime",placeholder:"订单日期",format:"yyyy-MM-dd HH:mm:ss",readonly:e.$permissionFn.readOnly()},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.inputEnterJump(t)}},model:{value:e.order_time,callback:function(t){e.order_time=t},expression:"order_time"}})],1),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("FormItem",{attrs:{label:"手工单号"}},[r("Input",{attrs:{placeholder:"请输入手工单号",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.order_no,callback:function(t){e.$set(e.orderForm,"order_no",t)},expression:"orderForm.order_no"}})],1),r("Form-item",{attrs:{label:"手工单号是否重复"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.ignore_order_no,callback:function(t){e.$set(e.orderForm,"ignore_order_no",t)},expression:"orderForm.ignore_order_no"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),Object.keys(e.curMember).length?r("FormItem",{attrs:{label:"积分"}},[r("Input",{attrs:{placeholder:"请输入积分",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.integral,callback:function(t){e.$set(e.orderForm,"integral",t)},expression:"orderForm.integral"}})],1):e._e(),Object.keys(e.curMember).length?r("FormItem",{attrs:{label:"会员密码"}},[r("Input",{attrs:{placeholder:"请输入会员密码",type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.memberPwd,callback:function(t){e.memberPwd=t},expression:"memberPwd"}})],1):e._e(),r("Form-item",{attrs:{label:"备注"}},[r("Input",{attrs:{placeholder:"请输入备注"},on:{"on-enter":function(t){e.inputEnterJump(t)}},model:{value:e.orderForm.memo,callback:function(t){e.$set(e.orderForm,"memo",t)},expression:"orderForm.memo"}})],1)],1),r("div",{staticClass:"row"},[r("FormItem",{attrs:{label:"客数"}},[r("div",{staticClass:"ks"},[r("Input",{staticStyle:{width:"210px"},attrs:{type:"number"},on:{"on-enter":function(t){e.inputEnterJump(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.body_count,callback:function(t){e.$set(e.orderForm,"body_count",t)},expression:"orderForm.body_count"}}),r("RadioGroup",{staticClass:"radio-inside",attrs:{slot:"prepend"},slot:"prepend",model:{value:e.orderForm.gender,callback:function(t){e.$set(e.orderForm,"gender",t)},expression:"orderForm.gender"}},[r("Radio",{attrs:{label:0}},[e._v("女")]),r("Radio",{attrs:{label:1}},[e._v("男")])],1)],1)]),r("Form-item",{attrs:{label:"是否发送信息提醒"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.notify,callback:function(t){e.$set(e.orderForm,"notify",t)},expression:"orderForm.notify"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),r("div",{staticClass:"row"},[r("span",{staticStyle:{"flex-shrink":"0",color:"red","font-size":"22px"}},[e._v(e._s("结算："+e.orderForm.gross_price))]),r("Button",{staticClass:"btn-confirm",attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.loading?"提交中":"立即结账"))])],1)],1),r("el-popover",{attrs:{id:"goodListPop",placement:"bottom",trigger:"manual"},model:{value:e.popGoodShow,callback:function(t){e.popGoodShow=t},expression:"popGoodShow"}},e._l(e.countList,(function(t,n){return r("div",{key:n,staticClass:"chooseList-wrapper"},[r("el-tooltip",{attrs:{effect:"dark",content:t.alias,placement:"bottom",disabled:t.alias.length<=10}},[r("div",{staticClass:"title"},[e._v(e._s(t.alias))])]),r("div",{staticClass:"chooseList"},e._l(t.children,(function(n,i){return r("div",{key:i,on:{click:function(r){e.selectGood(n,t)}}},[r("el-tooltip",{attrs:{effect:"dark",content:n.id+" "+n.alias,placement:"bottom",disabled:(n.id+" "+n.alias).length<=15}},[r("div",{staticClass:"chooseList-item"},[r("span",{staticClass:"num"},[e._v(e._s(n.id)+" ")]),r("span",{staticClass:"name"},[e._v(e._s(n.alias))])])])],1)})))],1)}))),r("Modal",{attrs:{width:"600px","footer-hide":""},model:{value:e.resultShow,callback:function(t){e.resultShow=t},expression:"resultShow"}},[r("div",{staticClass:"modal-result"},[r("Icon",{attrs:{type:"md-checkmark-circle-outline"}}),r("span",{staticClass:"title"},[e._v("结算成功")]),1==e.result.type?r("ul",{staticClass:"detail"},[r("li",[r("span",[e._v("会员姓名：")]),r("span",[e._v(e._s(e.result.name))])]),r("li",[r("span",[e._v("手机号：")]),r("span",[e._v(e._s(e.result.phone||"未填写手机号"))])]),r("li",[r("span",[e._v("卡号：")]),r("span",[e._v(e._s(e.result.cardNo||"未填写卡号"))])]),r("li",[r("span",[e._v("结算前余额：")]),r("span",[e._v(e._s(e.result.balance))])]),r("li",[r("span",[e._v("结算后余额：")]),r("span",[e._v(e._s(e.result.balanceAfter))])]),r("li",[r("span",[e._v("欠款：")]),r("span",[e._v(e._s(e.result.debtsAfter))])])]):r("span",{staticStyle:{"margin-top":"20px","font-size":"16px"}},[e._v("\n        尊敬的客人，您本次消费"+e._s(e.result.discountPriceAll)+"元\n      ")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.resultShow=!1}}},[e._v("确认")])],1)])],1)},x=[],M=(r("20d6"),{props:{ruleList:{type:Object,default:function(){}},curMember:{type:Object,default:function(){}},curMemberRule:{type:Object,default:function(){}},staffSortList:{type:Array,default:function(){return[]}}},data:function(){return{isDataLoad:!1,loading:!1,order_time:"",memberPwd:"",lastOrderNo:0,orderForm:Object(y["j"])({consume_type:0,body_count:1,gender:0}),bonusList:Object(y["g"])(),paymentCache:{},paymentList:Object(y["k"])(),memberPaymentList:Object(y["k"])("member"),categoryList:[],countList:[],goodList:Object(y["i"])(),popGoodShow:!1,curGoodIndex:0,disableGoodsFn:"",countUseList:[],countBoughtUseListCache:[],messageChokeFn:"",inputList:[],resultShow:!1,result:{}}},computed:{countBoughtUseList:function(){return this.$store.getters.countBoughtUseList||[]}},watch:{countBoughtUseList:function(){this.checkBoughtCountUse()},curMember:function(){var e=this;this.goodList.map((function(t){Object.keys(t.good).length&&(t.bonusList.map((function(r){e.matchRule(r,t.type,t.category.id,t.good.id)})),e.computeGoodItem(t))})),this.orderForm.gender=1===this.curMember.gender?1:0,this.getLastOrderNo()},staffSortList:function(){var e=this;this.staffSortList.length&&(this.initBonusListByPosition().then((function(){e.$set(e.goodList,0,e.createGoodItem())})),this.isDataLoad=!0)},order_time:function(e){"00:00:00"===Object(g["i"])(e,"{h}:{i}:{s}")&&(this.order_time=new Date(Object(g["i"])(e,"{y}-{m}-{d}")+" "+Object(g["i"])(new Date,"{h}:{i}:{s}")))}},created:function(){var e=this;this.init(),this.staffSortList&&this.initBonusListByPosition().then((function(){e.$set(e.goodList,0,e.createGoodItem()),e.isDataLoad=!0})),this.orderForm.gender=1===this.curMember.gender?1:0,this.watchPays()},methods:{init:function(){this.getCategoryList(),this.getLastOrderNo()},getCategoryList:function(){var e=this;return this.$api.common.getCategory().then((function(t){e.categoryList=t.data||{},e.countList=e.categoryList.tenant_meter||{},e.$api.common.getMeter().then((function(t){t.data&&Object.keys(t.data).map((function(e){t.data[e]=t.data[e]&&Object.values(t.data[e]).filter((function(e){return 0===e.status}))})),Object.keys(e.countList).map((function(r){e.countList[r].children=t.data[r]||[]})),e.countList=Object.values(e.countList),e.checkBoughtCountUse()}))}))},getLastOrderNo:function(){var e=this;return this.$api.business.getLastOrderNo().then((function(t){e.lastOrderNo=t.data?Number(t.data.order_no):0,e.orderForm.order_no=e.lastOrderNo+1}))},initBonusListByPosition:function(){var e=this;return new Promise((function(t){e.staffSortList.map((function(t,r){if(0!==r){var n=JSON.parse(JSON.stringify(e.bonusList[0]));n.index=r+1,e.bonusList.push(n)}})),t()}))},createGoodItem:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"count",t=Object(y["h"])();return t.type=e,t.useTimes=0,t.isInfinite=!1,t.surp=-1,t.bonusList=JSON.parse(JSON.stringify(this.bonusList)),["countBuyUse","countBoughtUse"].includes(e)?this.watchCountUse(t):this.watchGood(t)},checkBoughtCountUse:function(){var e=this;this.countBoughtUseList.map((function(t){var r=e.countBoughtUseListCache.find((function(e){return e.id===t.id}));if(!r){e.countBoughtUseListCache.push(t);var n={bought:t,good:{id:t.meter_id,alias:t.alias,employ_cardinal_price:t.employ_cardinal_price},category:{id:t.meter_category_id||0}};t.meter_category_id||e.$Message.warning("未找到该计次分类，请手动输入员工业绩与提成"),e.useCount(n,"bought")}}))},computeGoodItem:function(e){var t=Object(y["a"])({type:e.type,num:1,good:e.good,memberRule:this.curMemberRule});e.originalPrice=t.originalPrice,e.discount=t.discount,e.discountPrice=t.discountPrice,e.originalPriceAll=t.originalPriceAll,e.discountPriceAll=t.discountPriceAll},computeGoodItemBonu:function(e,t){if(e.staff_id||e.rule){var r=JSON.parse(JSON.stringify(e.rule)),n="count"===t.type?(1===r.type?t.discountPriceAll:t.originalPriceAll)-t.presentPrice:t.good.employ_cardinal_price*t.useTimes,i=t.presentPrice||0,o=Object(y["b"])(r,n,i,e.specified_switch);e.performance_price=o.pgSum,e.dividends_price=o.commission}},computePriceAll:function(){this.paymentList.map((function(e){e.amount_price=0})),this.result.discountPriceAll=this.goodList.reduce((function(e,t){return t.discountPriceAll&&(e+=Number(t.discountPriceAll)),e}),0),this.result.presentPriceAll=this.goodList.reduce((function(e,t){return t.presentPrice&&(e+=Number(t.presentPrice)),e}),0),this.result.discountPresentPriceAll=this.goodList.reduce((function(e,t){return t.discountPresentPrice&&(e+=Number(t.discountPresentPrice)),e}),0),this.result.discountPriceAll=(Number(this.result.discountPriceAll)-Number(this.result.presentPriceAll)).toFixed(2),Object.keys(this.curMember).length?(this.memberPaymentList.map((function(e){e.amount_price&&(e.amount_price=0)})),this.memberPaymentList.find((function(e){return"余额"===e.payment_name})).amount_price=this.result.discountPriceAll,this.memberPaymentList.find((function(e){return"赠金"===e.payment_name})).amount_price=this.result.discountPresentPriceAll,this.paymentCache=JSON.parse(JSON.stringify(this.memberPaymentList.find((function(e){return"余额"===e.payment_name}))))):(this.paymentList.map((function(e){e.amount_price&&(e.amount_price=0)})),this.paymentList.find((function(e){return"现金"===e.payment_name})).amount_price=this.result.discountPriceAll,this.paymentCache=JSON.parse(JSON.stringify(this.paymentList.find((function(e){return"现金"===e.payment_name}))))),Object.keys(this.curMember).length&&(this.orderForm.integral=Number(this.curMemberRule.consume_integral)?Number((this.result.discountPriceAll+this.result.presentPriceAll)/this.curMemberRule.consume_integral).toFixed(2):0,this.$store.commit("business/setPoint",Number(this.orderForm.integral))),this.orderForm.gross_price=Number(this.result.discountPriceAll)+Number(this.result.discountPresentPriceAll)},matchRule:function(e,t,r,n){this.messageChokeFn||(this.messageChokeFn=Object(g["e"])());var i={};if("count"===t?i=this.ruleList.tenant_meter||{}:"countBuyUse"!==t&&"countBoughtUse"!==t||(i=this.ruleList.tenant_meter_employ||{}),Object.keys(e.cur_position).length){var o=Boolean(e.cur_position.position_id);if(o&&i.hasOwnProperty(e.cur_position.position_id)&&i[e.cur_position.position_id].rule)e.rule=JSON.parse(i[e.cur_position.position_id].rule);else{if(!i.hasOwnProperty(e.cur_position.department_id)||!i[e.cur_position.department_id].rule)return this.messageChokeFn({type:"warning",content:"50001:当前职位并未设置计次服务规则，请手动输入提成及业绩"}),void(e.rule={});e.rule=JSON.parse(i[e.cur_position.department_id].rule)}if(this.curMember.hierarchy)if(e.rule[this.curMember.hierarchy])e.rule=e.rule[this.curMember.hierarchy];else{if(!e.rule["all"])return this.messageChokeFn({type:"warning",content:"50003:当前职位并未设置会员计次服务规则，请手动输入提成及业绩"}),void(e.rule={});e.rule=e.rule["all"]}else if(e.rule["normal"])e.rule=e.rule["normal"];else{if(!e.rule["all"])return this.messageChokeFn({type:"warning",content:"50002:当前职位并未设置散客计次服务规则，请手动输入提成及业绩"}),void(e.rule={});e.rule=e.rule["all"]}if(!r||!n)return void(e.rule={});if(!e.rule[r])return this.messageChokeFn({type:"warning",content:"50004:当前职位并未设置该计次服务规则，请手动输入提成及业绩"}),void(e.rule={});e.rule=e.rule[r],e.rule[n]?e.rule=e.rule[n]:(this.messageChokeFn({type:"warning",content:"50005:当前职位并未设置该计次服务规则，请手动输入提成及业绩"}),e.rule={})}},watchGood:function(e){var t=this,r=this;return e=new Proxy(e,{set:function(t,i,o,s){return t[i]=o,"good"===i&&t.bonusList.map((function(n){r.matchRule(n,t.type,t.category.id,t.good.id),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))})),"qty"===i&&(n(t),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))),"originalPrice"===i&&(t.discountPrice=Number(t.discount?t.discount/y["f"]*t.originalPrice:t.originalPrice).toFixed(2),n(t),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))),"discount"===i&&(t.originalPrice?t.discountPrice=Number(t[i]?t[i]/y["f"]*t.originalPrice:t.originalPrice).toFixed(2):t.discountPrice="",n(t),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))),"discountPriceAll"===i&&(r.$nextTick((function(){r.computePriceAll()})),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))),"presentPrice"===i&&(Number(t[i])>Number(t.discountPriceAll)?(setTimeout((function(){t.presentPrice=t.discountPriceAll,r.$nextTick((function(){t.discountPresentPrice=Number(Object.keys(r.curMemberRule).length?t.presentPrice*r.curMemberRule.giving_switch/y["f"]:t.presentPrice).toFixed(2),r.$nextTick((function(){r.computePriceAll(),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))}))}))})),r.$Message.error("赠金不能大于折后价")):r.$nextTick((function(){t.discountPresentPrice=Number(Object.keys(r.curMemberRule).length?t.presentPrice*r.curMemberRule.giving_switch/y["f"]:t.presentPrice).toFixed(2),r.$nextTick((function(){r.computePriceAll(),e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)}))}))}))),!0}}),e.bonusList.forEach((function(n,i){e.bonusList[i]=new Proxy(n,{set:r.bonusProxySet.bind(t,e)})})),e;function n(e){e.originalPriceAll=Number(e.originalPrice*e.qty).toFixed(2),e.discountPriceAll=Number(e.discountPrice).toFixed(2),e.discountPresentPrice=Number(Object.keys(r.curMemberRule).length?e.presentPrice*r.curMemberRule.giving_switch/100:e.presentPrice).toFixed(2),r.$nextTick((function(){r.computePriceAll()}))}},watchCountUse:function(e){var t=this,r=this;return e=new Proxy(e,{set:function(t,n,i,o){return t[n]=i,"useTimes"===n&&e.bonusList.forEach((function(t){r.computeGoodItemBonu(t,e)})),!0}}),e.bonusList.forEach((function(n,i){e.bonusList[i]=new Proxy(n,{set:r.bonusProxySet.bind(t,e)})})),e},bonusProxySet:function(e,t,r,n,i){if(t[r]=n,"show_num"===r)""===t.show_num&&(t.staff_id="",t.specified_switch=!1,t.performance_price="",t.dividends_price="");else if("staff_id"===r||"cur_position"===r){if(t.staff_id&&Object.keys(t.cur_position).length)return this.matchRule(t,e.type,e.category.id,e.good.id),this.computeGoodItemBonu(t,e),!0}else"specified_switch"===r?this.computeGoodItemBonu(t,e):"performance_price"===r&&Object.keys(t.rule).length&&(t.dividends_price=t.performance_price?Object(y["b"])(JSON.parse(JSON.stringify(t.rule)),1===t.rule.type?e.discountPrice:e.originalPrice,0,t.specified_switch,Object.assign({},{assign:"commission",custom:{pgSum:t.performance_price}})).commission:0);return!0},watchPays:function(){var e=this,t=this.paymentList.find((function(e){return"现金"===e.payment_name})),r=this.memberPaymentList.find((function(e){return"余额"===e.payment_name}));function n(){var n;n=Object.keys(e.curMember).length?e.memberPaymentList.reduce((function(e,t){return["余额","赠金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0):e.paymentList.reduce((function(e,t){return["现金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0),Object.keys(e.paymentCache).length&&(e.paymentCache.amount_price-n<0?e.$Message.info("计算过后的值不能小于0，请自行手动修改"):Object.keys(e.curMember).length?r.amount_price=Number(e.paymentCache.amount_price-n).toFixed(2):t.amount_price=Number(e.paymentCache.amount_price-n).toFixed(2))}function i(t){e.orderForm.integral=Number(e.$store.state.business.pointCache-t).toFixed(2)}this.paymentList.forEach((function(e,t,r){["现金"].includes(e.payment_name)||(r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,n(),!0}}))})),this.memberPaymentList.forEach((function(e,t,r){["余额","赠金"].includes(e.payment_name)||(r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,n(),"积分"===e.payment_name&&i(r),!0}}))}))},submit:function(){var e=this,t=Object.keys(this.curMember).length?"memberPaymentList":"paymentList";if(Object.keys(this.curMember).length)if(Object.keys(this.curMember).length&&this.curMember.password&&this.memberPwd!==this.curMember.password)this.$Message.error("会员密码错误");else if(!0!==this.loading){var r=this[t].reduce((function(t,r){return"余额"===r.payment_name&&(e.orderForm.payment_balance=Number(r.amount_price)),"赠金"===r.payment_name&&(e.orderForm.payment_giving=Number(r.amount_price)),"欠款"===r.payment_name&&(e.orderForm.payment_arrears=Number(r.amount_price)),t+(Number(r.amount_price)||0)}),0),n=this.countUseList.some((function(e){return"countBoughtUse"===e.type}));if(this.orderForm.gross_price<0&&!n)this.$Message.error("消费金额不能小于零");else if(r==this.orderForm.gross_price){if(Object.keys(this.curMember).length){if(this.orderForm.member_id=this.curMember.id||"",this.orderForm.payment_balance>this.curMember.balance_price)return void this.$Message.error("支付失败：支付卡金大于余额");if(this.orderForm.payment_giving>this.curMember.giving_price)return void this.$Message.error("支付失败：支付赠金大于赠金余额")}this.loading=!0,this.orderForm.profit_price=this.orderForm.gross_price-this.goodList.reduce((function(e,t){return t.good.cost_price&&(e+=t.good.cost_price),e}),0),this.orderForm.payments=JSON.stringify(this[t].filter((function(t){return!!Number(t.amount_price)&&("免单"===t.payment_name&&(e.orderForm.consume_type=2),"欠款"===t.payment_name&&(e.orderForm.consume_type=1),!0)}))),this.orderForm.alias=this.curMember.alias||"",this.orderForm.phone=this.curMember.phone||"",this.orderForm.order_time=Object(g["i"])(""!==this.order_time?this.order_time:new Date,"{y}-{m}-{d} {h}:{i}:{s}"),this.orderForm.bonus=JSON.stringify(i.call(this)),this.orderForm.meter_oredes=JSON.stringify(o.call(this)),this.orderForm.meter_surplus=JSON.stringify(s.call(this)),this.orderForm.shopping_cart=JSON.stringify(a.call(this)),"[]"===this.orderForm.bonus&&(this.orderForm.bonus=""),"[]"===this.orderForm.meter_oredes&&(this.orderForm.meter_oredes=""),"[]"===this.orderForm.meter_surplus&&(this.orderForm.meter_surplus=""),"[]"===this.orderForm.shopping_cart&&(this.orderForm.shopping_cart=""),"[]"===this.orderForm.payments&&(this.orderForm.payments=""),Object.keys(this.curMember).length&&(this.orderForm.notify_format=Object(y["l"])("count",this.curMember,Object.assign({},this.orderForm,{goodList:this.goodList}))),this.$api.business.addOrder(this.orderForm).then((function(t){if(Object.keys(e.curMember).length){e.result.type=1;var r=e.curMember;e.result.name=r.alias,e.result.phone=r.phone,e.result.cardNo=r.serial_num,e.result.balance=r.balance_price,e.result.debts=r.arrears_price,e.result.balanceAfter=Number(e.result.balance-e.orderForm.payment_balance).toFixed(2),e.result.debtsAfter=Number(e.result.debts+e.orderForm.payment_arrears).toFixed(2),e.result.integralAfter=Number(e.curMember.integral)+Number(e.orderForm.integral)}else e.result.type=2;e.resultShow=!0,e.$emit("order-success",{memberRefresh:Boolean(Object.keys(e.curMember).length),type:"count",order:e.orderForm,result:e.result}),e.reset(),e.loading=!1}),(function(t){e.$Notice.error({title:"错误",desc:"订单创建失败",duration:30}),e.loading=!1}))}else this.$Message.error("支付方式金额总和与消费金额不一致")}else this.$Message.error("上一笔订单尚未提交完成，请稍后再试");else this.$Message.error("请选择会员");function i(){var e=[];return this.goodList.map((function(t){e=e.concat(JSON.parse(JSON.stringify(t.bonusList.filter((function(e){if(!e.staff_id)return!1;var t=e.dividends_price;return e.performance_price=e.performance_price||0,e.dividends_price=t,delete e.show_num,delete e.rule,delete e.index,!0})))))})),this.countUseList.map((function(t){e=e.concat(JSON.parse(JSON.stringify(t.bonusList.filter((function(e){if(!e.staff_id)return!1;var t=e.dividends_price;return e.performance_price=e.performance_price||0,e.dividends_price=t,delete e.show_num,delete e.rule,delete e.index,!0})))))})),e}function o(){var e=[];return this.goodList.map((function(t){if(Object.keys(t.good).length&&t.good.id){var r=e.find((function(e){return e.meter_id===t.good.id}));if(r)r.validity_num+=Number(t.qty);else{var n={meter_id:Number(t.good.id),alias:t.good.alias,exprice_time:t.good.validity_time,validity_num:Number(t.qty),employ_cardinal_price:Number(t.good.employ_cardinal_price),uses_num:0};n.exprice_time&&(n.exprice_time=Object(g["i"])((new Date).getTime()+864e5*Number(n.exprice_time))),e.push(n)}}})),this.countUseList.map((function(t){if("countBuyUse"===t.type){var r=e.find((function(e){return e.meter_id===t.good.id}));r&&(r.uses_num+=Number(t.useTimes))}"countBoughtUse"===t.type&&e.push({id:t.bought.id,uses_num:Number(t.useTimes)})})),e}function s(){var e=[];return this.goodList.map((function(t){if(Object.keys(t.good).length&&t.good.id){var r=e.find((function(e){return t.good&&e.self_id==t.good.id}));r?(r.qty+=1,r.price+=Number(t.originalPriceAll)):e.push({self_id:Number(t.good.id),qty:1,type:"tenant_orders",price:Number(t.originalPriceAll)})}})),e}function a(){var e=this,t=[];return this.goodList.map((function(e,r){if(e.good.id){var n=JSON.parse(JSON.stringify(e));delete n.bonusList,t.push(n)}})),this.countUseList.map((function(r,n){var i=JSON.parse(JSON.stringify(r));"countBuyUse"===r.type?e.goodList.map((function(e,t){e.good.id&&e.good.id===r.good.id&&(i.isInfinite=0===Number(e.qty)&&!0,i.surp=0===Number(e.qty)?0:Number(e.qty)-Number(r.useTimes))})):"countBoughtUse"===r.type&&e.countBoughtUseList.map((function(e){e.id===r.bought.id&&(i.isInfinite=0===Number(e.validity_num)&&!0,i.surp=0===Number(e.validity_num)?0:Number(e.validity_num)-Number(e.uses_num)-Number(r.useTimes))})),delete i.bonusList,t.push(i)})),t}},showGoods:function(e,t){this.curGoodIndex=t.$index;var r=e.srcElement,n=document.querySelector("#goodListPop"),i=s(r),o=a(r);function s(e){var t=e.offsetTop;return e.classList.contains("count")?0:(null!=e.offsetParent&&(t+=s(e.offsetParent)),t)}function a(e){var t=e.offsetLeft;return e.classList.contains("count")?0:(null!=e.offsetParent&&(t+=a(e.offsetParent)),t)}n.style.top="".concat(i+r.offsetHeight+10,"px"),n.style.left="".concat(o,"px"),this.popGoodShow=!0,this.disableGoodsFn&&document.removeEventListener("click",this.disableGoodsFn),this.disableGoodsFn=this.disableGoods(r,n)},disableGoods:function(e,t){var r=this;function n(i){i&&(i.path.some((function(t){return t===e}))||i.path.some((function(e){return e===t}))||(r.popGoodShow=!1,document.removeEventListener("click",n)))}return document.addEventListener("click",n),n},selectGood:function(e,t){var r=this;function n(){return this.goodList.reduce((function(e,t){return e<t.index?t.index:e}),0)+1}this.popGoodShow=!1,this.goodList[this.curGoodIndex].index=n.call(this),this.goodList[this.curGoodIndex].type="count",this.goodList[this.curGoodIndex].category=t,this.goodList[this.curGoodIndex].good=JSON.parse(JSON.stringify(e)),this.goodList[this.curGoodIndex].qty=e.validity_num,this.goodList[this.curGoodIndex].bonusList.map((function(t){t.type="tenant_meter",t.source_alias=e.alias,t.source_id=e.id,t.source_weight=r.goodList[r.curGoodIndex].index})),this.computeGoodItem(this.goodList[this.curGoodIndex]),this.goodList.some((function(e){return!Object.keys(e.good).length}))||(this.goodList.push(this.createGoodItem()),this.$nextTick(function(){this.inputList=Array.from(document.querySelector(".count").querySelectorAll("input.ivu-input"))}.bind(this))),document.removeEventListener("click",this.disableGoodsFn)},searchGood:function(e,t){var r=this,n=this.countList,i=t.good.id;if(!i)return this.popGoodShow=!1,document.removeEventListener("click",this.disableGoodsFn),void this.inputEnterJump(e);n.some((function(e){return e.children.some((function(t){if(i==t.id)return r.selectGood(t,e),!0}))}))?this.inputEnterJump(e):(t.type="",t.qty="",t.good={},this.computeGoodItem(this.goodList[this.curGoodIndex]),this.$Message.error("没有搜索到该项目"))},removeGood:function(e){this.computeGoodItem(this.goodList[e]),this.goodList.splice(e,1)},useCount:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"buy",r=this.countUseList.findIndex((function(t){return t.good.id===e.good.id&&"countBuyUse"===t.type}));if("buy"===t&&r<0||"bought"===t){var n=this.createGoodItem("buy"===t?"countBuyUse":"countBoughtUse");n.index=i.call(this),n.category=e.category,n.good=e.good,"bought"===t&&(n.bought=e.bought),n.originalPrice=e.good.employ_cardinal_price||0,n.useTimes=1,n.bonusList.map((function(t){t.type="tenant_meter_employ",t.source_alias=e.good.alias,t.source_id=e.good.id,t.source_weight=n.index})),this.countUseList.push(n)}else this.$Message.info("使用表单中已存在该项目");function i(){return this.countUseList.reduce((function(e,t){return e<t.index?t.index:e}),0)+1}this.$nextTick(function(){this.inputList=Array.from(document.querySelector(".count").querySelectorAll("input.ivu-input"))}.bind(this))},chooseStaff:function(e,t,r,n){e.staff_id=r.id,e.show_num=r.serial_num,e.cur_position=r.position[t.id]},searchStaff:function(e,t,r){var n=r.staffList.find((function(e){return t.show_num==e.serial_num}));t.show_num?n?(t.staff_id=n.id,t.cur_position=n.position[r.id],this.inputEnterJump(e)):(t.staff_id="",t.show_id="",t.cur_position={},t.rule={},this.$Message.error("没有搜索到员工")):this.inputEnterJump(e)},inputEnterJump:function(e){var t=this;this.inputList.length||(this.inputList=Array.from(document.querySelector(".count").querySelectorAll("input.ivu-input")));var r=e.srcElement;this.inputList.some((function(e,n){if(n===t.inputList.length-1)t.submit();else if(r==e)return t.inputList[n+1].focus(),!0}))},reset:function(){this.goodList=Object(y["i"])(),this.$set(this.goodList,0,this.createGoodItem()),this.countUseList=[],this.$store.commit("business/setCountBoughtUseList",[]),this.paymentCache={},this.paymentList.map((function(e){e.amount_price=0})),this.memberPaymentList.map((function(e){e.amount_price=0})),this.orderForm=Object(y["j"])({consume_type:0,body_count:1,gender:0}),this.lastOrderNo++,this.orderForm.order_no=this.lastOrderNo+1,this.order_time="",this.memberPwd="",this.countBoughtUseListCache=[]}},destroyed:function(){this.countBoughtUseList.length&&this.$store.commit("business/setCountBoughtUseList",[])}}),I=M,C=(r("f044"),Object(p["a"])(I,T,x,!1,null,"654c133e",null));C.options.__file="count.vue";var j=C.exports,$=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"el-table-custom"},[r("el-table",{staticClass:"table-consume-custom",attrs:{"header-cell-class-name":"el-table-header-cell-custom",data:[{}],fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"充值金额","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.prestore_price,callback:function(t){e.$set(e.orderForm,"prestore_price",t)},expression:"orderForm.prestore_price"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"赠送金额","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.giving_price,callback:function(t){e.$set(e.orderForm,"giving_price",t)},expression:"orderForm.giving_price"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"积分","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Input",{attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.integral,callback:function(t){e.$set(e.orderForm,"integral",t)},expression:"orderForm.integral"}})]}}])}),e._l(e.bonusList,(function(t,n){return r("el-table-column",{key:n,attrs:{align:"center",label:"提成人"+(n+1)}},[r("el-table-column",{attrs:{align:"center",label:"工号",width:"80"},scopedSlots:e._u([{key:"default",fn:function(n){return[r("Poptip",{attrs:{trigger:"focus",placement:"bottom","popper-class":"poptip-staff",transfer:""}},[r("Input",{attrs:{placeholder:"请选择"},model:{value:t.show_num,callback:function(r){e.$set(t,"show_num",r)},expression:"item.show_num"}}),r("div",{staticClass:"positionList",attrs:{slot:"content"},slot:"content"},e._l(e.staffSortList,(function(n,i){return r("div",{key:i,staticClass:"positionList-item"},[r("span",{staticClass:"title"},[e._v(e._s(n.alias)+"：")]),r("div",{staticClass:"staffList"},e._l(n.staffList,(function(i,o){return r("div",{key:o,staticClass:"staffList-item",on:{click:function(r){e.chooseStaff(t,n,i)}}},[e._v("\n                      "+e._s(i.serial_num+" "+i.staff_name)+"\n                    ")])})))])})))],1)]}}])}),r("el-table-column",{attrs:{align:"center",label:"指定",width:"50"},scopedSlots:e._u([{key:"default",fn:function(n){return[r("Checkbox",{model:{value:t.specified_switch,callback:function(r){e.$set(t,"specified_switch",r)},expression:"item.specified_switch"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"业绩"},scopedSlots:e._u([{key:"default",fn:function(n){return[r("Input",{attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.performance_price,callback:function(r){e.$set(t,"performance_price",r)},expression:"item.performance_price"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"提成"},scopedSlots:e._u([{key:"default",fn:function(n){return[r("Input",{attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.dividends_price,callback:function(r){e.$set(t,"dividends_price",r)},expression:"item.dividends_price"}})]}}])})],1)}))],2),r("Form",{ref:"orderForm",attrs:{model:e.orderForm,"label-width":80,"label-position":"right"}},[r("FormItem",{staticStyle:{"margin-top":"25px"},attrs:{label:"支付方式"}},e._l(e.memberPaymentList,(function(t,n){return r("div",{key:n},[r("Col",{attrs:{span:"2"}},[r("Input",{staticClass:"input-commission",attrs:{size:"large"},model:{value:t.amount_price,callback:function(r){e.$set(t,"amount_price",r)},expression:"item.amount_price"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(t.payment_name))])])],1)],1)}))),r("div",{staticClass:"row"},[r("FormItem",{attrs:{label:"订单日期"}},[r("DatePicker",{attrs:{type:"datetime",placeholder:"订单日期",format:"yyyy-MM-dd HH:mm:ss",readonly:e.$permissionFn.readOnly()},model:{value:e.order_time,callback:function(t){e.order_time=t},expression:"order_time"}})],1),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("FormItem",{attrs:{label:"手工单号"}},[r("Input",{attrs:{size:"large",type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.orderForm.order_no,callback:function(t){e.$set(e.orderForm,"order_no",t)},expression:"orderForm.order_no"}})],1),r("Form-item",{attrs:{label:"手工单号是否重复"}},[r("i-switch",{attrs:{"true-value":1,"false-value":0},model:{value:e.orderForm.ignore_order_no,callback:function(t){e.$set(e.orderForm,"ignore_order_no",t)},expression:"orderForm.ignore_order_no"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1),r("Form-item",{attrs:{label:"备注"}},[r("Input",{attrs:{placeholder:"请输入备注"},model:{value:e.orderForm.memo,callback:function(t){e.$set(e.orderForm,"memo",t)},expression:"orderForm.memo"}})],1)],1),r("div",{staticClass:"row"},[r("Form-item",{attrs:{label:"是否发送信息提醒"}},[r("i-switch",{attrs:{size:"large","true-value":1,"false-value":0},model:{value:e.orderForm.notify,callback:function(t){e.$set(e.orderForm,"notify",t)},expression:"orderForm.notify"}},[r("span",{attrs:{slot:"1"},slot:"1"},[e._v("是")]),r("span",{attrs:{slot:"0"},slot:"0"},[e._v("否")])])],1)],1)],1),r("div",{staticClass:"row",staticStyle:{"justify-content":"space-between"}},[r("span",{staticStyle:{color:"red","font-size":"22px"}},[e._v(e._s("结算："+e.orderForm.prestore_price))]),r("Button",{staticClass:"btn-confirm",attrs:{type:"primary",size:"large",loading:e.loading},on:{click:e.submit}},[e._v(e._s(e.loading?"提交中":"确定"))])],1)],1)},E=[],A={props:{ruleList:{type:Object,default:function(){}},curMember:{type:Object,default:function(){}},curMemberRule:{type:Object,default:function(){}},presentRule:{type:Array,default:function(){return[]}},memberRuleList:{type:Array,default:function(){return[]}},positionList:{type:Array,default:function(){return[]}},staffList:{type:Array,default:function(){return[]}},staffSortList:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,locationMap:[],lastOrderNo:0,order_time:"",orderForm:Object(y["j"])({consume_type:5}),bonusList:Object(y["g"])("tenant_prestore","充值"),paymentCache:{},memberPaymentList:Object(y["k"])()}},watch:{"orderForm.prestore_price":function(e){this.memberPaymentList[0].amount_price=e,this.paymentCache=JSON.parse(JSON.stringify(this.memberPaymentList.find((function(e){return"现金"===e.payment_name})))),this.computeAll(),Object.keys(this.curMemberRule).length&&this.pointCompute(),this.presentCompute()},"orderForm.giving_price":function(){this.computeAll()},order_time:function(e){"00:00:00"===Object(g["i"])(e,"{h}:{i}:{s}")&&(this.order_time=new Date(Object(g["i"])(e,"{y}-{m}-{d}")+" "+Object(g["i"])(new Date,"{h}:{i}:{s}")))}},created:function(){var e=this;this.$api.business.getLastOrderNo().then((function(t){e.lastOrderNo=t.data?Number(t.data.order_no):0,e.orderForm.order_no=e.lastOrderNo+1})),this.watchBonus(),this.memberPaymentList.splice(3,0,{payment_name:"欠款",amount_price:""}),this.watchPays()},methods:{chooseStaff:function(e,t,r,n){e.staff_id=r.id,e.show_num=r.serial_num,e.cur_position=r.position[t.id]},matchRule:function(e){if(Object.keys(e.cur_position).length){var t=Boolean(e.cur_position.position_id);if(t&&this.ruleList.hasOwnProperty(e.cur_position.position_id)&&this.ruleList[e.cur_position.position_id].rule)e.rule=JSON.parse(this.ruleList[e.cur_position.position_id].rule);else{if(!this.ruleList.hasOwnProperty(e.cur_position.department_id)||!this.ruleList[e.cur_position.department_id].rule)return this.$Message.warning("50001:当前职位并未设置开卡规则，请手动输入提成及业绩"),void(e.rule=JSON.parse(JSON.stringify(y["c"])));e.rule=JSON.parse(this.ruleList[e.cur_position.department_id].rule)}this.curMember.hierarchy?e.rule[this.curMember.hierarchy]?e.rule=e.rule[this.curMember.hierarchy]:e.rule["all"]?e.rule=e.rule["all"]:(this.$Message.warning("50003:当前职位并未设置对应会员消费规则，请手动输入提成及业绩"),e.rule=JSON.parse(JSON.stringify(y["c"]))):e.rule["normal"]?e.rule=e.rule["normal"]:e.rule["all"]?e.rule=e.rule["all"]:(this.$Message.warning("50002:当前职位并未设置散客消费规则，请手动输入提成及业绩"),e.rule=JSON.parse(JSON.stringify(y["c"])))}},getLocationMap:function(){var e=this;this.locationMap=[],this.bonusList.forEach((function(t,r){t.staff_id&&e.locationMap.push(r)}))},computeAll:function(){var e=this;this.locationMap.forEach((function(t,r){if(e.bonusList[t].staff_id){var n=JSON.parse(JSON.stringify(e.bonusList[t].rule[e.locationMap.length].employees[r])),i=Object(y["b"])(n,e.orderForm.prestore_price,e.orderForm.giving_price,e.bonusList[t].specified_switch);e.bonusList[t].performance_price=i.pgSum,e.bonusList[t].dividends_price=i.commission}}))},presentCompute:function(){var e=this;if(this.presentRule.length){var t=-1;this.presentRule.forEach((function(r,n,i){e.orderForm.prestore_price>=Number(r.price)&&(t>=0?Number(i[t].price)<Number(r.price)&&(t=n):t=n)})),this.orderForm.giving_price=t>=0?Number(this.presentRule[t].giving_price):0}},pointCompute:function(){this.orderForm.integral=Number(this.curMemberRule.prestore_integral)?Number(this.orderForm.prestore_price/this.curMemberRule.prestore_integral).toFixed(2):0},watchBonus:function(){for(var e=this,t=this,r=0;r<=2;r++){var n=JSON.parse(JSON.stringify(this.bonusList[0]));0===r?n.type="tenant_deposit":(n.index=r+1,this.bonusList.push(n))}this.bonusList.forEach((function(r,n){e.bonusList[n]=new Proxy(r,{set:function(e,r,i,o){if(e[r]=i,"show_num"===r)""===e.show_num&&(e.staff_id="",e.specified_switch=!1,e.performance_price="",e.dividends_price="",t.computeAll());else if("staff_id"===r||"cur_position"===r){if(t.getLocationMap(),e.staff_id&&Object.keys(e.cur_position).length)return t.matchRule(e),t.computeAll(),!0}else if("specified_switch"===r)t.computeAll();else if("performance_price"===r){var s=t.locationMap.length,a=t.bonusList.findIndex((function(e){return e===t.bonusList[n]})),c=t.locationMap.indexOf(a);c>=0&&(e.dividends_price=e.performance_price?Object(y["b"])(JSON.parse(JSON.stringify(e.rule[s].employees[c])),t.orderForm.prestore_price,t.orderForm.giving_price,e.specified_switch,Object.assign({},{assign:"commission",custom:{pgSum:e.performance_price}})).commission:0)}return!0}})}))},watchPays:function(){var e=this,t=this.memberPaymentList.find((function(e){return"现金"===e.payment_name}));function r(){var r;r=e.memberPaymentList.reduce((function(e,t){return["现金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0),Object.keys(e.paymentCache).length&&(e.paymentCache.amount_price-r<0?e.$Message.info("计算过后的值不能小于0，请自行手动修改"):t.amount_price=Number(e.paymentCache.amount_price-r).toFixed(2))}this.memberPaymentList.forEach((function(e,t,n){["现金"].includes(e.payment_name)||(n[t]=new Proxy(e,{set:function(e,t,n){return e[t]=n,r(),!0}}))}))},submit:function(){var e=this;this.loading=!0;var t=this.memberPaymentList.reduce((function(e,t){return t.amount_price?e+Number(t.amount_price):e}),0);if(t!==Number(this.orderForm.prestore_price))return this.$Message.error("支付方式金额总和与充值金额不一致"),void(this.loading=!1);this.bonusList.map((function(e){delete e.rule,delete e.index})),this.orderForm.member_id=this.curMember.id,this.orderForm.bonus=JSON.stringify(this.bonusList.filter((function(e){return!!e.staff_id&&(delete e.show_num,delete e.rule,delete e.index,!0)}))),this.orderForm.payments=JSON.stringify(this.memberPaymentList.filter((function(t){return!!Number(t.amount_price)&&("免单"===t.payment_name&&(e.orderForm.consume_type=2),"欠款"===t.payment_name&&(e.orderForm.payment_arrears=Number(t.amount_price),e.orderForm.consume_type=1),!0)}))),this.orderForm.order_time=Object(g["i"])(""!==this.order_time?this.order_time:new Date),"[]"===this.orderForm.bonus&&(this.orderForm.bonus=""),"[]"===this.orderForm.payments&&(this.orderForm.payments=""),this.orderForm.alias=this.curMember.alias||"",this.orderForm.phone=this.curMember.phone||"",this.orderForm.gender=this.curMember.gender||0,this.orderForm.gross_price=Number(this.orderForm.prestore_price),this.orderForm.profit_price=this.orderForm.gross_price,Object.keys(this.curMember).length&&(this.orderForm.notify_format=Object(y["l"])("recharge",this.curMember,this.orderForm)),this.$api.business.addOrder(this.orderForm).then((function(t){e.loading=!1,e.$emit("success",{type:"recharge",order:e.orderForm}),e.$Message.success("充值成功")}),(function(t){e.$Notice.error({title:"错误",desc:"充值失败",duration:30}),e.loading=!1}))}}},R=A,J=(r("a42a"),Object(p["a"])(R,$,E,!1,null,"54736327",null));J.options.__file="recharge.vue";var G=J.exports,B=r("3cbd"),z=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"debt"},[r("h3",{staticClass:"title"},[e._v("还款")]),r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"订单日期",prop:"repay_time"}},[r("el-date-picker",{staticClass:"custom",attrs:{type:"datetime",placeholder:"选择日期时间",align:"right","picker-options":e.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.form.repay_time,callback:function(t){e.$set(e.form,"repay_time",t)},expression:"form.repay_time"}})],1),r("el-form-item",{attrs:{label:"还款金额",prop:"arrears_price"}},[r("el-input",{staticClass:"custom",attrs:{type:"number",placeholder:"请输入还款金额"},model:{value:e.form.arrears_price,callback:function(t){e.$set(e.form,"arrears_price",t)},expression:"form.arrears_price"}})],1),r("el-form-item",{attrs:{label:"支付方式"}},[r("div",{staticClass:"payments"},e._l(e.paymentList,(function(t,n){return r("div",{key:n},[r("el-input",{staticClass:"input-commission",attrs:{size:"large",type:"number"},model:{value:t.amount_price,callback:function(r){e.$set(t,"amount_price",r)},expression:"item.amount_price"}},[r("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v(e._s(t.payment_name))])])],1)})))])],1),r("div",{staticStyle:{"text-align":"center"}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submit("form")}}},[e._v("提交")]),r("el-button",{on:{click:function(t){e.reset("form")}}},[e._v("重置")])],1)],1)},X=[],V={props:{curMember:{type:Object,default:function(){}}},data:function(){return{pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},paymentCache:{},paymentList:Object(y["k"])(),form:{arrears_price:"",memo:"",payments:"",repay_time:""},rules:{arrears_price:[{required:!0,message:"请输入还款金额",trigger:"blur"}]}}},watch:{"form.arrears_price":function(e){var t=this.paymentList.find((function(e){return"现金"===e.payment_name}));t.amount_price=e,this.paymentCache=JSON.parse(JSON.stringify(t))}},created:function(){this.watchPays()},methods:{watchPays:function(){var e=this,t=this.paymentList.find((function(e){return"现金"===e.payment_name}));function r(){var r;r=e.paymentList.reduce((function(e,t){return["现金"].includes(t.payment_name)?e:e+Number(t.amount_price)}),0),Object.keys(e.paymentCache).length&&(e.paymentCache.amount_price-r<0?e.$Message.info("计算过后的值不能小于0，请自行手动修改"):t.amount_price=Number(e.paymentCache.amount_price-r).toFixed(2))}this.paymentList.forEach((function(e,t,n){["现金"].includes(e.payment_name)||(n[t]=new Proxy(e,{set:function(e,t,n){return e[t]=n,r(),!0}}))}))},submit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var r=t.paymentList.reduce((function(e,t){return e+(t.amount_price?Number(t.amount_price):0)}),0);if(r!==Number(t.form.arrears_price))return void t.$Message.error("支付方式金额总和不等于还款金额");t.form.payments=JSON.stringify(t.paymentList.filter((function(e){return e.amount_price}))),delete t.form.arrears_price,t.form.repay_time||(t.form.repay_time=Object(g["i"])(new Date)),t.$api.member.editMemberDebt(t.curMember.id,t.form).then((function(e){t.$Message.success("还款成功"),t.$emit("success")}))}}))},reset:function(e){var t=this;this.$nextTick((function(){t.$refs[e].resetFields()}))}}},U=V,q=(r("72f7"),Object(p["a"])(U,z,X,!1,null,"4c82a01a",null));q.options.__file="debt.vue";var H=q.exports,Y=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-table",{staticClass:"table-consume-custom",attrs:{data:e.list.slice((e.pageVar.page-1)*e.pageVar.pageSize,e.pageVar.page*e.pageVar.pageSize),"header-cell-class-name":"el-table-header-cell-custom",fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"使用时间",width:"155"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.order_time))]}}])}),r("el-table-column",{attrs:{align:"center",label:"计次名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.data.alias))]}}])}),r("el-table-column",{attrs:{align:"center",label:"使用次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.employ_num))]}}])}),r("el-table-column",{attrs:{align:"center",label:"剩余使用次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==e.detail.validity_num?"不限次数":t.row.surplus_num))]}}])})],1),r("el-pagination",{attrs:{"current-page":e.pageVar.page,"page-sizes":e.pageVar.pageSizes,"page-size":e.pageVar.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageVar.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},Z=[],K={props:{data:{type:Object,default:function(){}}},data:function(){return{detail:"",list:[],pageVar:{page:1,total:0,pageSize:50,pageSizes:[10,20,30,40,50]}}},watch:{data:{handler:function(){this.detail=this.data,this.list=this.data.employs,this.pageVar.total=this.list.length},deep:!0}},methods:{handleSizeChange:function(e){this.pageVar.pageSize=e,this.pageVar.page=1},handleCurrentChange:function(e){this.pageVar.page=e}}},Q=K,W=Object(p["a"])(Q,Y,Z,!1,null,null,null);W.options.__file="countUseView.vue";var ee=W.exports,te=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list.slice((e.pageVar.page-1)*e.pageVar.pageSize,e.pageVar.page*e.pageVar.pageSize),fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.id))]}}])}),r("el-table-column",{attrs:{align:"center",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alias))]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换积分"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.integral))]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{type:"number",placeholder:"请输入兑换数量"},model:{value:t.row.num,callback:function(r){e.$set(t.row,"num",e._n(r))},expression:"scope.row.num"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换所需积分"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{type:"number",placeholder:"请输入兑换所需积分"},model:{value:t.row.integralAll,callback:function(r){e.$set(t.row,"integralAll",e._n(r))},expression:"scope.row.integralAll"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"操作",width:"145"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(r){e.handleBeforeSubmit(t.row)}}},[e._v("立即兑换")])]}}])})],1),r("el-pagination",{attrs:{"current-page":e.pageVar.page,"page-sizes":e.pageVar.pageSizes,"page-size":e.pageVar.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageVar.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},re=[],ne={props:{curMember:{type:Object,default:function(){}}},data:function(){return{listLoading:!1,form:{},list:[],pageVar:{page:1,total:0,pageSize:10,pageSizes:[10,20,30,40]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.$api.common.getIntegral().then((function(t){e.list=t.data&&t.data.filter((function(e){if(0===e.status)return e.num=1,e.integralAll=e.integral,!0}))||[],e.list.forEach((function(e,t,r){r[t]=new Proxy(e,{set:function(e,t,r){return e[t]=r,"num"===t&&(e.integralAll=e.num*e.integral),!0}})})),e.pageVar.total=e.list.length}))},handleBeforeSubmit:function(e){var t=this;this.curMember.id?e.num?this.$alert("是否确认兑换该商品？&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","提示",{confirmButtonText:"确定",dangerouslyUseHTMLString:!0,callback:function(r){"confirm"===r&&t.submit(e)}}):this.$Message.info("兑换商品数量不能为零"):this.$Message.info("请先选择会员")},submit:function(e){var t=this;this.form={exchange_time:Object(g["i"])(new Date),surplus:JSON.stringify([{qty:e.num,self_id:e.id,self_alias:e.alias,integral:e.integralAll}])},this.$api.business.integralExchange(this.curMember.id,this.form).then((function(e){t.$Message.success("兑换成功"),t.$emit("order-success",{noPrint:!0,memberRefresh:!0})}))},handleSizeChange:function(e){this.pageVar.pageSize=e,this.pageVar.page=1},handleCurrentChange:function(e){this.pageVar.page=e}}},ie=ne,oe=(r("f431"),Object(p["a"])(ie,te,re,!1,null,"054f98a4",null));oe.options.__file="integral.vue";var se=oe.exports,ae=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-table",{attrs:{data:[{}],fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"兑换积分"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{type:"number",placeholder:"请输入兑换积分"},model:{value:e.form.integral,callback:function(t){e.$set(e.form,"integral",e._n(t))},expression:"form.integral"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换余额"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input",{attrs:{type:"number",placeholder:"请输入兑换余额"},model:{value:e.form.balance,callback:function(t){e.$set(e.form,"balance",e._n(t))},expression:"form.balance"}})]}}])}),r("el-table-column",{attrs:{align:"center",label:"操作",width:"145"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.submit()}}},[e._v("立即兑换")])]}}])})],1)],1)},ce=[];function ue(){return{integral:"",balance:""}}var le={props:{curMember:{type:Object,default:function(){}}},data:function(){return{form:ue(),orderForm:Object(y["j"])()}},created:function(){this.getLastOrderNo()},methods:{getLastOrderNo:function(){var e=this;this.$api.business.getLastOrderNo().then((function(t){e.lastOrderNo=t.data?Number(t.data.order_no):0,e.orderForm.order_no=e.lastOrderNo+1}))},submit:function(){var e=this;this.curMember.id?this.form.integral?this.form.balance?(this.orderForm.alias=this.curMember.alias,this.orderForm.phone=this.curMember.phone,this.orderForm.gender=this.curMember.gender,this.orderForm.member_id=this.curMember.id,this.orderForm.integral=-this.form.integral,this.orderForm.prestore_price=this.form.balance,this.orderForm.order_time=Object(g["i"])(new Date),this.$api.business.addOrder(this.orderForm).then((function(t){e.$Message.success("兑换成功"),e.orderForm.order_no+=1,e.$emit("order-success",{noPrint:!0,memberRefresh:!0}),e.form=ue()}),(function(t){e.$Notice.error({title:"错误",desc:"兑换失败",duration:30}),e.loading=!1}))):this.$Message.info("兑换余额不能为0"):this.$Message.info("兑换积分不能为0"):this.$Message.info("请先选择会员")}}},me=le,de=(r("99ac"),Object(p["a"])(me,ae,ce,!1,null,"7f5155c6",null));de.options.__file="integralExchange.vue";var pe=de.exports,fe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticClass:"table-consume-custom",attrs:{data:e.list.slice((e.pageVar.page-1)*e.pageVar.pageSize,e.pageVar.page*e.pageVar.pageSize),"cell-class-name":"bonusCellClass",fit:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"会员姓名",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member.alias))]}}])}),r("el-table-column",{attrs:{align:"center",label:"手机号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.member.phone))]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换时间","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.exchange_time))]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.self_alias))]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换前积分","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.befor_integral))]}}])}),r("el-table-column",{attrs:{align:"center",label:"消费积分","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.integral))]}}])}),r("el-table-column",{attrs:{align:"center",label:"兑换后积分","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.after_integral))]}}])})],1),r("el-pagination",{attrs:{"current-page":e.pageVar.page,"page-sizes":e.pageVar.pageSizes,"page-size":e.pageVar.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageVar.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},he=[],be={data:function(){return{dateDuring:"",searchForm:{start_time:"",end_time:""},listLoading:!1,list:[],memberList:[],pageVar:{page:1,total:0,pageSize:50,pageSizes:[10,20,30,40,50]}}},watch:{dateDuring:function(){this.dateDuring&&this.dateDuring.length?(this.searchForm.start_time=Object(g["i"])(this.dateDuring[0],"{y}-{m}-{d}")+" 00:00:00",this.searchForm.end_time=Object(g["i"])(this.dateDuring[1],"{y}-{m}-{d}")+" 23:59:59"):(this.searchForm.start_time="",this.searchForm.end_time="")}},created:function(){this.dateDuring=[Object(g["i"])(new Date,"{y}-{m}-{d}")+" 00:00:00",Object(g["i"])(new Date,"{y}-{m}-{d}")+" 23:59:59"],setTimeout(function(){this.init()}.bind(this))},methods:{init:function(){var e=this;this.getMemberList().then((function(t){e.memberList=t||[],e.getList()}))},getMemberList:function(){return this.$api.common.getMemberList().then((function(e){return e.data}))},getList:function(){var e=this,t=new Date(this.searchForm.end_time).getTime()-new Date(this.searchForm.start_time).getTime();!isNaN(t)&&t>26784e5?this.$Message.info("日期范围不能大于1个月"):(this.listLoading=!0,this.$api.member.getMemberIntegralList(this.searchForm).then((function(t){var r=t.data||[];r.map((function(t){e.memberList.some((function(e){if(e.id===t.member_id)return t["member"]=e,!0}))})),e.list=r,e.pageVar.total=e.list.length,e.listLoading=!1})))},handleSizeChange:function(e){this.pageVar.pageSize=e,this.pageVar.page=1},handleCurrentChange:function(e){this.pageVar.page=e}}},_e=be,ge=(r("d40c"),Object(p["a"])(_e,fe,he,!1,null,"08a71411",null));ge.options.__file="integralRecord.vue";var ye=ge.exports,ve={components:{MemberSearch:c["a"],CountUseBtn:h,Consume:O,Good:D,Count:j,Integral:se,IntegralExchange:pe,IntegralRecord:ye,Recharge:G,OrderMember:B["a"],Debt:H,CountUseView:ee},data:function(){return{curMember:{},memberList:[],orderShow:!1,debtShow:!1,componentName:"",rechargeShow:!1,rechargeRuleList:{},ruleList:{},curMemberRule:{},presentRule:[],memberRuleList:[],positionList:[],staffList:[],staffSortList:[],countUseShow:!1,countUseViewData:{},memberCountList:[]}},watch:{curMember:function(){Object.keys(this.curMember).length?this.getMemberCountList():this.memberCountList=[]},componentName:function(e,t){"count"!==e||Object.keys(this.curMember).length||(this.$nextTick(function(){this.componentName=t}.bind(this)),this.$Message.info("计次消费为会员消费方式，请先选择会员"))},$route:{handler:function(){this.componentName=this.$route.params.type},deep:!0}},created:function(){this.componentName=this.$route.params.type,this.init()},methods:Object(o["a"])({},Object(s["c"])(["closeTag"]),{init:function(){var e=this;this.getMemberList().then((function(){e.getMemberRuleList().then((function(){if(e.$route.query.backMemberId){var t=e.memberList.find((function(t){return t.id===Number(e.$route.query.backMemberId)}));t&&e.handleMemberSelect(t)}}))})),this.getRuleList(),this.sortStaffListByPosition()},getMemberList:function(){var e=this;return this.$api.common.getMemberList().then((function(t){e.memberList=t.data?Object.values(t.data).filter((function(e){return 0===e.status})):[]}))},getMemberRuleList:function(){var e=this;return this.$api.user.getInfo().then((function(t){e.memberRuleList=t.data.member_rule?Object.values(JSON.parse(t.data.member_rule)):{},e.presentRule=t.data.recharge_rule?Object.values(JSON.parse(t.data.recharge_rule)):{}}))},getRuleList:function(){var e=this;this.$api.common.getRoyalty().then((function(t){e.ruleList=t.data||{},e.rechargeRuleList=t.data.tenant_deposit||{}}))},getMemberCountList:function(){var e=this;this.$api.member.getMemberCountList({member_id:this.curMember.id}).then((function(t){e.memberCountList=t.data||[]}))},sortStaffListByPosition:function(){var e=this;function t(){var e=this;this.staffSortList=JSON.parse(JSON.stringify(this.positionList)),this.staffSortList.map((function(t){e.staffList.map((function(e){e.position.hasOwnProperty(t.id)&&(!t.staffList&&(t.staffList=[]),t.staffList.push(e))}))}))}this.$api.common.getPosition().then((function(r){e.positionList=Object.values(r.data).filter((function(e){return 0===e.status})),e.$api.common.getStaffList().then((function(r){e.staffList=Object.values(r.data).filter((function(e){return 0===e.status})),t.call(e)}))}))},handleMemberSelect:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.useful_date&&(new Date).getTime()>e.useful_date&&this.$Message.info("会员已过期"),this.$store.dispatch("store/findStore",e.tenant_id).then((function(n){e.origin=n&&n.store_name,t.curMemberRule=t.memberRuleList.find((function(t){if(t.id==e.hierarchy)return e.hierarchyName=t.alias,!0}));var i=new Date(Object(g["i"])(new Date,"{y}-{m}-{d}")),o=new Date(Object(g["i"])(e.update_time,"{y}-{m}-{d}"));e.arrivalInterval=(i-o)/1e3/3600/24,t.curMember=e,e.arrears_price>0&&r&&(t.debtShow=!0)}))},handleCountUse:function(e){"good"===this.componentName&&(this.componentName="count")},handleCountView:function(e){this.countUseViewData=e,this.countUseShow=!0},rechargeSuccess:function(e){var t=this;this.rechargeShow=!1,this.getMemberList().then((function(e){if(Object.keys(t.curMember).length){var r=t.memberList.find((function(e){return e.id===t.curMember.id}));t.handleMemberSelect(r)}})),this.handlePrint(e)},debtSuccess:function(){var e=this;this.debtShow=!1,this.getMemberList().then((function(t){if(Object.keys(e.curMember).length){var r=e.memberList.find((function(t){return t.id===e.curMember.id}));e.handleMemberSelect(r,!1)}}))},orderSuccess:function(e){e&&e.memberRefresh&&this.getMemberList(),e.noPrint||this.handlePrint({type:e.type,order:e.order,result:e.result}),this.curMember={},this.curMemberRule={}},handlePrint:function(e){if(this.$store.state.print.setting.switch&&this.$store.state.print.isLodopLoad){var t=this.$getLodop(document.getElementById("LODOP_OB"),document.getElementById("LODOP_EM")),r={type:e.type,orderTime:e.order.order_time,paymentList:e.order.payments?JSON.parse(e.order.payments):[],result:{payment:"",balance:"",integral:""}};["card","recharge"].includes(e.type)?(r.recharge={deposit:e.order.prestore_price?Number(e.order.prestore_price):0,present:e.order.giving_price?Number(e.order.giving_price):0,actual:0},r.recharge.actual=Number(r.recharge.deposit)+Number(r.recharge.present),r.result.balance=Number(this.curMember.balance_price)+r.recharge.deposit,r.result.integral=Number(this.curMember.integral)+Number(e.order.integral)):"consume"===e.type?(r.consume={originalPayment:Number(e.order.gross_price)},r.result.balance=e.result.balanceAfter?Number(e.result.balanceAfter):0,r.result.integral=e.result.integralAfter?Number(e.result.integralAfter):0):("good"===e.type||"count"===e.type)&&(r.goodList=JSON.parse(e.order.shopping_cart),r.result.balance=e.result.balanceAfter?Number(e.result.balanceAfter):0,r.result.integral=e.result.integralAfter?Number(e.result.integralAfter):0),r.result.payment=r.paymentList?r.paymentList.reduce((function(e,t){return e+Number(t.amount_price)}),0):0;var n=new a["a"](t,{name:this.$store.getters.userInfo.store_name,phone:this.$store.getters.userInfo.trade,addr:this.$store.getters.userInfo.addr});n.createOrder({exist:Boolean(Object.keys(this.curMember).length),name:this.curMember.alias,cardNo:this.curMember.serial_num,phone:this.curMember.phone},r),n.setNum(Number(this.$store.state.print.setting.num)),n.print()}}})},we=ve,Le=(r("f0ad"),Object(p["a"])(we,n,i,!1,null,"3dfa9eb8",null));Le.options.__file="buy.vue";t["default"]=Le.exports},a29b:function(e,t,r){"use strict";var n=r("a79a"),i=r.n(n);i.a},a42a:function(e,t,r){"use strict";var n=r("08dc"),i=r.n(n);i.a},a79a:function(e,t,r){},b369:function(e,t,r){},b39c:function(e,t,n){"use strict";n.d(t,"j",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"i",(function(){return a})),n.d(t,"h",(function(){return c})),n.d(t,"k",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return d})),n.d(t,"n",(function(){return p})),n.d(t,"m",(function(){return f})),n.d(t,"b",(function(){return h})),n.d(t,"f",(function(){return b})),n.d(t,"a",(function(){return _})),n.d(t,"l",(function(){return y}));n("7f7f"),n("7514"),n("6762"),n("2fdb"),n("c5f6"),n("456d"),n("ac6a"),n("5df3"),n("f400"),n("cadf"),n("551c"),n("097d");var i=n("4360");function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={member_id:"",payment_arrears:"",payment_balance:"",payment_giving:"",payment_integral:"",order_no:"",ignore_order_no:0,shopping_cart:"",consume_type:"",system_calculate:"",gross_price:"",profit_price:"",integral:"",prestore_price:"",giving_price:"",arrears_price:"",alias:"",phone:"",gender:"",payments:"",coupones:"",commodity_surplus:"",meter_oredes:"",meter_combo_oredes:"",order_time:"",memo:"",is_new_member:0,notify:1,notify_format:"",bonus:"",body_count:""};return g(t,e),t}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return[{type:e,staff_id:"",performance_price:"",dividends_price:"",specified_switch:0,source_id:0,source_alias:t,source_weight:0,index:1,show_num:"",cur_position:{},rule:""}]}function a(){return[c()]}function c(){return{type:"",category:{},good:{},originalPrice:"",qty:"",discount:"",discountPrice:"",presentPrice:"",discountPresentPrice:"",bonusList:s()}}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=[{payment_name:"现金",amount_price:""},{payment_name:"微信",amount_price:""},{payment_name:"支付宝",amount_price:""},{payment_name:"银联",amount_price:""},{payment_name:"pos",amount_price:""},{payment_name:"免单",amount_price:""},{payment_name:"收钱吧",amount_price:""},{payment_name:"美团",amount_price:""},{payment_name:"其他",amount_price:""}];if("member"===e){var r=JSON.parse(JSON.stringify(t));return r.splice(0,0,{payment_name:"余额",amount_price:""},{payment_name:"赠金",amount_price:""},{payment_name:"欠款",amount_price:""},{payment_name:"积分",amount_price:""}),r}return t}var l={type:1,commission:{specified:{type:1,value:0},unspecified:{type:1,value:0}},perform:{specified:{type:1,value:0},unspecified:{type:1,value:0}},grants:{type:1,value:0},cost:{specified:{type:1,value:0},unspecified:{type:1,value:0}},twice:{specified:{type:1,value:0},unspecified:{type:1,value:0}}},m={commission:{specified:{type:1,value:0},unspecified:{type:1,value:0}},perform:{specified:{type:1,value:0},unspecified:{type:1,value:0}},grants:{type:1,value:0}},d={1:{type:1,employees:[JSON.parse(JSON.stringify(m))]},2:{type:1,employees:[JSON.parse(JSON.stringify(m)),JSON.parse(JSON.stringify(m))]},3:{type:1,employees:[JSON.parse(JSON.stringify(m)),JSON.parse(JSON.stringify(m)),JSON.parse(JSON.stringify(m))]}},p={type:1,commission:{specified:{type:1,value:0},unspecified:{type:1,value:0}},perform:{specified:{type:1,value:0},unspecified:{type:1,value:0}},grants:{type:1,value:0},cost:{specified:{type:1,value:0},unspecified:{type:1,value:0}},twice:{specified:{type:1,value:0},unspecified:{type:1,value:0}}},f={};function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=100,a=new Map([["commission",u],["perform",m],["grants",d],["pgSum",l],["cost",p],["twice",f]]);Object.keys(e).map((function(t){e[t].value&&(e[t].value=Number(e[t].value)),["type","grants"].includes(t)||(e[t]=i?e[t].specified:e[t].unspecified)}));var c={cost:0,twice:0,perform:0,grants:0,pgSum:0,commission:0};return o.custom&&g(c,o.custom),o.assign?(a.get(o.assign)(e[o.assign],c),c):(Object.keys(c).forEach((function(t){if(!c[t]&&(!o.custom||!o.custom.hasOwnProperty(t))&&("pgSum"===t&&a.get(t)(c),e.hasOwnProperty(t))){if(1!==e[t].type&&2!==e[t].type)throw new Error("错误类型值r.type：".concat(r.type));e[t].value&&a.get(t)(e[t],c)}})),Object.keys(c).map((function(e){c[e]=Number(c[e]).toFixed(2)})),c);function u(e,r){var n=r.pgSum||t-r.cost-r.twice||0;1===e.type?r.commission=n*e.value/s:2===e.type&&(r.commission=Number(e.value))}function l(e){e.pgSum=e.perform+e.grants}function m(e,r){var n=t-r.cost-r.twice;1===e.type?r.perform=n*e.value/s:2===e.type&&(r.perform=Number(e.value))}function d(e,t){1===e.type?t.grants=n*e.value/s:2===e.type&&(t.grants=Number(e.value))}function p(e,r){1===e.type?r.cost=t*e.value/s:2===e.type&&(r.cost=Number(e.value))}function f(e,r){1===e.type?r.twice=(t-r.cost)*e.value/s:2===e.type&&(r.twice=Number(e.value))}}var b=10;function _(e){var t={type:"commodity",num:0,price:0,memberPrice:0,cost:0,onlyDiscountByGood:0,isSpecial:0,recoup:0,discount:1,memberDiscount:1,good:{},memberRule:{}};g(t,e);var r=Boolean(Object.keys(t.memberRule).length),n=t.good;if(t.price=n.sale_price,t.memberPrice=n.member_price,t.cost=n.cost_price,t.onlyDiscountByGood=n.discount_switch,t.isSpecial=n.special_switch,t.recoup=n.again_member_switch,t.discount=n.discount,t.discount/=b,r)switch(t.type){case"commodity":t.memberDiscount=Number(t.memberRule.commodity)/b;break;case"services":t.memberDiscount=Number(t.memberRule.project)/b;break;case"count":t.memberDiscount=Number(t.memberRule.project)/b;break;default:break}var i={type:-1,originalPrice:0,discount:10,discountPrice:0,originalPriceAll:0,discountPriceAll:0};if(!t.type)return i;var o=!1,s={};if(r&&"services"===t.type&&t.good.member_rule){var a=JSON.parse(t.good.member_rule);o=a[t.memberRule.id],s=a[t.memberRule.id]}return i.originalPrice=r&&"count"!==t.type?t.memberPrice:t.price,"count"===t.type?!t.good.special_switch&&r?(i.discount=t.memberDiscount,i.discountPrice=i.originalPrice*i.discount):(i.discount=1,i.discountPrice=i.originalPrice):o?1===Number(s.type)?(i.discount=1,i.discountPrice=Number(s.ratio)):(i.discount=Number(s.ratio)/b,i.discountPrice=i.originalPrice*i.discount):t.onlyDiscountByGood?(i.type=2,i.discount=t.discount,i.discountPrice=i.originalPrice*i.discount):t.recoup?(i.type=3,i.discount=t.discount*(t.memberDiscount||1),i.discountPrice=i.originalPrice*i.discount):(i.type=1,i.discount=t.discount,i.discountPrice=i.originalPrice),i.originalPriceAll=i.originalPrice*t.num,i.discountPriceAll=i.discountPrice*t.num,Object.keys(i).forEach((function(e){i[e]="discount"!==e?Number(i[e]).toFixed(2):Number(10*i[e]).toFixed(1)})),i}function g(e,t){Object.keys(t).map((function(r){e.hasOwnProperty(r)&&(e[r]=t[r])}))}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>2?arguments[2]:void 0,r=i["a"].getters.userInfo,n="";if(["good","count"].includes(e)){var o=[];t.goodList&&t.goodList.map((function(e){if(Object.keys(e.good).length&&e.good.id){var t=o.find((function(t){return t.id===e.good.id}));t?(t.qty+=Number(e.qty),t.price+=Number(e.discountPriceAll)):o.push({id:e.good.id,name:e.good.alias,qty:Number(e.qty),price:Number(e.discountPriceAll)})}})),o.map((function(e,t){n+="".concat(e.name,"(数量：").concat(e.qty,"，价格：").concat(e.price,")").concat(t===o.length-1?"":",")}))}var s={lable:"card"===e||"recharge"===e?"充值":"消费",sms:{title:"".concat(r.sms_title),remake:"".concat(r.sms_remake)},wechat:{first:n,remake:"".concat(r.sms_remake," ").concat(r.telephone)}};return"count"===e&&(s.sms.meter=n),"card"===e?s.wechat.first="开卡 ".concat(t.gross_price,"元"):"recharge"===e?s.wechat.first="充值 ".concat(t.gross_price,"元"):"consume"===e&&(s.wechat.first="快速消费 ".concat(t.gross_price,"元")),s}},badc:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-autocomplete",{attrs:{size:"medium","fetch-suggestions":e.querySearchAsync,placeholder:"请输入内容","popper-class":"search-suggestion","popper-append-to-body":!1,"highlight-first-item":""},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){return[t.item.alias?r("div",{staticClass:"item"},[r("span",{staticClass:"ellipsis-1"},[e._v(e._s(t.item.alias))]),r("span",[e._v(e._s(t.item.phone||"暂无数据"))]),r("span",{staticClass:"ellipsis-1"},[e._v(e._s(t.item.serial_num||"暂无数据"))]),r("span",{staticClass:"ellipsis-1"},[e._v(e._s(t.item.balance_price))])]):r("div",{staticClass:"empty"},[e._v("\n      未搜索到相关数据\n    ")])]}}]),model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[r("template",{slot:"prepend"},[e._t("prepend")],2),r("template",{slot:"suffix"},[e._t("suffix")],2)],2)},i=[],o=(r("ac6a"),r("8615"),r("1962")),s={props:{showText:{type:Boolean,default:!1},memberList:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,curMemberList:[],searchText:"",searchPopHead:"",searchMemberListShow:!1,searchTimeout:0}},created:function(){this.memberList.length?this.loading=!0:this.getMemberList()},mounted:function(){var e=document.querySelector(".el-autocomplete-suggestion__list");this.searchPopHead=document.createElement("li"),this.searchPopHead.innerHTML='<div class="item">\n      <span>名称</span><span>手机号</span><span>卡号</span><span>余额</span>\n      </div>',e.appendChild(this.searchPopHead)},methods:{getMemberList:function(){var e=this;this.$api.common.getMemberList().then((function(t){e.curMemberList=t.data&&Object.values(t.data).filter((function(e){return 0===e.status})),e.loading=!0}))},querySearchAsync:function(e,t){var r=this;if(e)if(this.searchPopHead.style.display="none",this.loading){var n=this.memberList.length?this.memberList:this.curMemberList,i=e?Object(o["a"])(e,n):[];i.length||(i[0]={}),clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((function(){r.searchPopHead.style.display="block",t(i)}),200)}else setTimeout((function(){r.querySearchAsync(e,t)}),200);else{var s=[];t(s)}},handleSelect:function(e){this.showText&&(this.searchText=e.alias),this.$emit("selected",e)}}},a=s,c=(r("321d"),r("2877")),u=Object(c["a"])(a,n,i,!1,null,"54be5a71",null);u.options.__file="memberSearch.vue";t["a"]=u.exports},be6c:function(e,t,r){},d40c:function(e,t,r){"use strict";var n=r("8b7e"),i=r.n(n);i.a},ec03:function(e,t,r){},f044:function(e,t,r){"use strict";var n=r("1e00"),i=r.n(n);i.a},f0ad:function(e,t,r){"use strict";var n=r("4901"),i=r.n(n);i.a},f400:function(e,t,r){"use strict";var n=r("c26b"),i=r("b39a"),o="Map";e.exports=r("e0b8")(o,(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(i(this,o),e);return t&&t.v},set:function(e,t){return n.def(i(this,o),0===e?0:e,t)}},n,!0)},f431:function(e,t,r){"use strict";var n=r("92af"),i=r.n(n);i.a},fe63:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("c5f6"),r("6762"),r("2fdb"),r("a481"),r("7f7f"),r("ac6a"),r("5df3"),r("f400"),r("cadf"),r("551c"),r("097d");var n=r("ed08");function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.LODOP=e,this.store={name:"",phone:"",addr:""},Object(n["d"])(this.store,t)}i.prototype.createOrder=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=15,o=580,s=18,a=65;this.member={exist:0,name:"",cardNo:"",phone:""};var c=new Map([["card",1],["recharge",2],["consume",3],["good",4],["count",5]]);this.order={type:1,orderTime:"",recharge:{deposit:"",present:"",actual:""},consume:{originalPayment:""},goodList:[],paymentList:[],result:{}},Object(n["d"])(this.member,t),Object(n["d"])(this.order,r),this.order.type=c.get(r.type),this.LODOP.SET_PRINT_PAGESIZE(3,o),this.LODOP.PRINT_INIT("订单信息"),i+=s,this.LODOP.SET_PRINT_STYLE("FontSize",12),this.LODOP.SET_PRINT_STYLE("Bold",1),this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"店名:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,this.store.name),i+=s,this.LODOP.SET_PRINT_STYLE("FontSize",10),this.LODOP.SET_PRINT_STYLE("Bold",1),this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"联系电话:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,this.store.phone),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"地址:"),this.LODOP.ADD_PRINT_TEXT(i,35,o,s,this.store.addr),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"******************************"),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"日期:"),this.LODOP.ADD_PRINT_TEXT(i,a-25,o,s,this.order.orderTime),i+=s,this.member.exist?(this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"会员姓名:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,this.member.name),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"卡号:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,this.member.cardNo),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"手机号:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,this.member.phone&&this.member.phone.replace(/^(\d{3})\d{4}(\d{4})$/,"$1****$2")),i+=s):(this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"散客"),i+=s),this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"******************************"),i+=s,[1,2].includes(this.order.type)?(this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"项目名称:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,1===this.order.type?"会员开卡":"会员充值"),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"充值金额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.recharge.deposit).toFixed(2)),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"赠送金额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.recharge.present).toFixed(2)),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"到账金额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.recharge.actual).toFixed(2)),i+=s):3===this.order.type?(this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"项目名称:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,"快速消费"),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"消费金额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.consume.originalPayment).toFixed(2)),i+=s):4===this.order.type?this.order.goodList.map((function(t,r){e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"项目名称:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,t.good.alias),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"数量:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(t.qty)),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"价格:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(t.originalPriceAll).toFixed(2)),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"折后价:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(t.discountPriceAll).toFixed(2)),i+=s,r<e.order.goodList.length-1&&(e.LODOP.ADD_PRINT_TEXT(i,1,o,s,".............................."),i+=s)})):5===this.order.type&&this.order.goodList.map((function(t,r){"count"===t.type?(e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"计次名称:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,t.good.alias),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"次数:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,t.isInfinite?"不限次数":Number(t.qty)),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"价格:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(t.originalPriceAll).toFixed(2)),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"折后价:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(t.discountPriceAll).toFixed(2)),i+=s):(e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"计次名称:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,t.good.alias),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"使用次数:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(t.useTimes)),i+=s,e.LODOP.ADD_PRINT_TEXT(i,1,o,s,"剩余次数:"),e.LODOP.ADD_PRINT_TEXT(i,a,o,s,t.isInfinite?"不限次数":Number(t.surp)),i+=s),r<e.order.goodList.length-1&&(e.LODOP.ADD_PRINT_TEXT(i,1,o,s,".............................."),i+=s)})),this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"******************************"),i+=s,[3,4,5].includes(this.order.type)&&(this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"实付金额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.result.payment).toFixed(2)),i+=s),this.member.exist&&(this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"账户余额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.result.balance).toFixed(2)),i+=s,this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"积分余额:"),this.LODOP.ADD_PRINT_TEXT(i,a,o,s,Number(this.order.result.integral).toFixed(2)),i+=s),this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"支付方式:"),this.order.paymentList.map((function(t){e.LODOP.ADD_PRINT_TEXT(i,a,o,s,t.payment_name),e.LODOP.ADD_PRINT_TEXT(i,2*a,o,s,Number(t.amount_price).toFixed(2)),i+=s})),this.order.paymentList.length||(i+=s),this.LODOP.ADD_PRINT_TEXT(i,1,o,s,"******************************"),i+=s,this.LODOP.ADD_PRINT_TEXT(i,25,o,s,"谢谢惠顾,欢迎下次光临!"),this.LODOP.SET_PRINT_PAGESIZE(3,o,45,"订单信息")},i.prototype.createReport=function(e){var t=this,r=15,i=580,o=18,s=140;this.LODOP.SET_PRINT_PAGESIZE(3,i),this.LODOP.PRINT_INIT("报表信息"),this.LODOP.SET_PRINT_STYLE("FontSize",13),this.LODOP.SET_PRINT_STYLE("Bold",1),this.LODOP.ADD_PRINT_TEXT(r,60,i,o,"今日报表"),r+=o,r+=o,this.LODOP.SET_PRINT_STYLE("FontSize",12),this.LODOP.SET_PRINT_STYLE("Bold",1),this.LODOP.ADD_PRINT_TEXT(r,1,i,o,"店名:"),this.LODOP.ADD_PRINT_TEXT(r,80,i,o,this.store.name),r+=o,this.LODOP.SET_PRINT_STYLE("FontSize",10),this.LODOP.SET_PRINT_STYLE("Bold",1),this.LODOP.ADD_PRINT_TEXT(r,1,i,o,"联系电话:"),this.LODOP.ADD_PRINT_TEXT(r,60,i,o,this.store.phone),r+=o,this.LODOP.ADD_PRINT_TEXT(r,1,i,o,"地址:"),this.LODOP.ADD_PRINT_TEXT(r,35,i,o,this.store.addr),r+=o,this.LODOP.ADD_PRINT_TEXT(r,1,i,o,"日期:"),this.LODOP.ADD_PRINT_TEXT(r,50,i,o,Object(n["i"])(new Date)),r+=o,this.LODOP.ADD_PRINT_TEXT(r,1,i,o,"******************************"),r+=o,this.LODOP.SET_PRINT_STYLE("FontSize",10),this.LODOP.SET_PRINT_STYLE("Bold",1),e.forEach((function(e,n){t.LODOP.ADD_PRINT_TEXT(r,1,i,o,"".concat(e.name,":")),t.LODOP.ADD_PRINT_TEXT(r,s,i,o,e.val),r+=o})),this.LODOP.SET_PRINT_PAGESIZE(3,i,45,"订单信息")},i.prototype.print=function(){this.LODOP.PRINT()},i.prototype.setNum=function(e){this.LODOP.SET_PRINT_COPIES(e)}}}]);